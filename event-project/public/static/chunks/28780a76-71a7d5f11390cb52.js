"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5250],{73027:function(e,t,n){n.d(t,{IG:function(){return v},oe:function(){return tO},pe:function(){return t1},rY:function(){return t7}});var r,s=n(35660),a=n(8144),i=n(44996),o=n(35354),u=n(78424),c=n(18920);(l=h||(h={})).NONE="none",l.JOINED="joined",l.INVITED="invited",l.LEFT="left";var l,h,d,p,_,f,m,v,g,y,b=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.state=null,r.role=null,r.isMuted=!1,r.isBlockedByMe=!1,r.isBlockingMe=!1,r.state=(0,s.H)(h,n.state)?n.state:null,r.role=(0,s.H)(s.R,n.role)?n.role:null,n.hasOwnProperty("is_muted")&&(r.isMuted=n.is_muted),n.hasOwnProperty("is_blocked_by_me")&&(r.isBlockedByMe=n.is_blocked_by_me),n.hasOwnProperty("is_blocking_me")&&(r.isBlockingMe=n.is_blocking_me),r}return(0,s._)(t,e),t.payloadify=function(t){return t?(0,s.e)((0,s.g)((0,s.g)({},e.payloadify.call(this,t)),{state:t.state,role:t.role,is_muted:t.isMuted,is_blocked_by_me:t.isBlockedByMe,is_blocking_me:t.isBlockingMe})):null},t}(a.g),E=function(e){function t(t,n){var r,a,i=this;return(i=e.call(this,t)||this).channelUrl=null!==(r=n.channel_url)&&void 0!==r?r:"",i.channelType=null!==(a=n.channel_type)&&void 0!==a?a:s.K.GROUP,i.reader=new s.U(i._iid,n.user),i.readAt=n.ts,i}return(0,s._)(t,e),t}(s.T);(C=d||(d={})).ALL="all",C.PUBLIC="public",C.PRIVATE="private",(M=p||(p={})).ALL="all",M.JOINED="joined_only",M.INVITED="invited_only",M.INVITED_BY_FRIEND="invited_by_friend",M.INVITED_BY_NON_FRIEND="invited_by_non_friend",(N=_||(_={})).ALL="all",N.SUPER="super",N.NON_SUPER="nonsuper",N.BROADCAST_ONLY="broadcast_only",N.EXCLUSIVE_ONLY="exclusive_only",(S=f||(f={})).ALL="all",S.UNREAD_MESSAGE="unread_message",(U=m||(m={})).ALL="all",U.UNHIDDEN="unhidden_only",U.HIDDEN="hidden_only",U.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",U.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide",(A=v||(v={})).ALL="all",A.OPERATOR="operator",A.NONOPERATOR="nonoperator",(I=g||(g={})).AND="AND",I.OR="OR",(T=y||(y={})).MEMBER_NICKNAME="member_nickname",T.CHANNEL_NAME="channel_name";var C,M,N,S,U,A,I,T,w,D=function(){function e(){this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter=null,this.nicknameStartsWithFilter=null,this.nicknameExactMatchFilter=null,this.channelNameContainsFilter="",this.myMemberStateFilter=p.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=_.ALL,this.publicChannelFilter=d.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=f.ALL,this.hiddenChannelFilter=m.UNHIDDEN,this.includeFrozen=!0}return e.prototype._isFriend=function(e){return!!e.friendDiscoveryKey||!!e.friendName},Object.defineProperty(e.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),e.prototype.setSearchFilter=function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})},Object.defineProperty(e.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),e.prototype.setUserIdsFilter=function(e,t,n){void 0===n&&(n=g.AND),this._userIdsFilter={userIds:e,includeMode:t,queryType:n}},e.prototype.clone=function(){var t=new e;this.searchFilter&&t.setSearchFilter(this.searchFilter.fields,this.searchFilter.query),this.userIdsFilter&&t.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach(function(e){t[e]=n[e]}),t},e.prototype.match=function(e,t){if(this._searchFilter){var n=this._searchFilter,r=n.query,a=n.fields;if(r&&a&&a.length>0&&!a.some(function(t){switch(t){case y.CHANNEL_NAME:return e.name.toLowerCase().includes(r.toLowerCase());case y.MEMBER_NICKNAME:return e.members.some(function(e){return e.nickname.toLowerCase().includes(r.toLowerCase())});default:return!0}}))return!1}if(this._userIdsFilter){var i=this._userIdsFilter,o=i.userIds,u=i.includeMode,c=i.queryType,l=e.members.map(function(e){return e.userId});if(u){if(o.length>0)switch(c){case g.AND:if(o.some(function(e){return!l.includes(e)}))return!1;break;case g.OR:if(o.every(function(e){return!l.includes(e)}))return!1}}else if(o.includes(t)||o.push(t),e.members.length>o.length||!(0,s.az)(o,l))return!1}if(!this.includeEmpty&&!e.lastMessage||!this.includeFrozen&&e.isFrozen||this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType)||this.customTypeStartsWithFilter&&!RegExp("^".concat(this.customTypeStartsWithFilter)).test(e.customType)||this.channelNameContainsFilter&&!e.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var h=this.nicknameContainsFilter.toLowerCase();if(!e.members.some(function(e){return e.userId!==t&&e.nickname.toLowerCase().includes(h)}))return!1}if(this.nicknameStartsWithFilter){var v=this.nicknameStartsWithFilter.toLowerCase();if(!e.members.some(function(e){return e.userId!==t&&e.nickname.toLowerCase().startsWith(v)}))return!1}if(this.nicknameExactMatchFilter){var b=this.nicknameExactMatchFilter.toLowerCase();if(!e.members.some(function(e){return e.userId!==t&&e.nickname.toLowerCase()!=b}))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(e.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case p.JOINED:if("joined"!==e.myMemberState)return!1;break;case p.INVITED:if("invited"!==e.myMemberState)return!1;break;case p.INVITED_BY_FRIEND:if("invited"!==e.myMemberState||!this._isFriend(e.inviter))return!1;break;case p.INVITED_BY_NON_FRIEND:if("invited"!==e.myMemberState||this._isFriend(e.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case m.UNHIDDEN:if(e.isHidden||"unhidden"!==e.hiddenState)return!1;break;case m.HIDDEN:if(!e.isHidden)return!1;break;case m.HIDDEN_ALLOW_AUTO_UNHIDE:if(!e.isHidden||"hidden_allow_auto_unhide"!==e.hiddenState)return!1;break;case m.HIDDEN_PREVENT_AUTO_UNHIDE:if(!e.isHidden||"hidden_prevent_auto_unhide"!==e.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===f.UNREAD_MESSAGE&&0===e.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case d.PUBLIC:if(!e.isPublic)return!1;break;case d.PRIVATE:if(e.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case _.SUPER:if(!e.isSuper)return!1;break;case _.NON_SUPER:if(e.isSuper)return!1}return!0},e}(),L=function(e){function t(t,n){var r=n.sdkState,s=n.cacheContext,a=e.call(this,t)||this;return a._channels=new Map,a._sdkState=r,a._cacheContext=s,a}return(0,s._)(t,e),Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection(a.N):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e,t){return void 0===t&&(t=0),(0,s.g)((0,s.g)({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})},t.prototype._deserialize=function(e){return eq.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(t.prototype,"channels",{get:function(){return(0,s.o)([],(0,s.p)(this._channels.values()),!1)},enumerable:!1,configurable:!0}),t.prototype.isCachedInMemory=function(e){return this._channels.has(e)},t.prototype.filterOffsetChanged=function(e){var t=this;return e.filter(function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp})},t.prototype.get=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n;return(0,s.c)(this,function(r){switch(r.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=r.sent())return n=this._deserialize(t),this._channels.set(e,n),[2,n];r.label=2;case 2:return[2,null];case 3:return[2,this._channels.get(e)]}})})},t.prototype.fetch=function(e){var t=e.token,n=e.limit,r=void 0===n?a.o:n,o=e.backward,u=void 0!==o&&o,c=e.filter,l=void 0===c?new D:c,h=e.order,d=void 0===h?i.G.LATEST_LAST_MESSAGE:h;return(0,s.b)(this,void 0,void 0,function(){var e,n,a=this;return(0,s.c)(this,function(s){switch(s.label){case 0:return this.localCacheEnabled?(e={where:function(e){if(t)switch(d){case i.G.CHANNEL_NAME_ALPHABETICAL:if(!u&&0>e.name.localeCompare(t)||u&&e.name.localeCompare(t)>0)return!1;break;case i.G.CHRONOLOGICAL:if(!u&&e.createdAt>t||u&&e.createdAt<t)return!1;break;case i.G.LATEST_LAST_MESSAGE:if(!u&&e.lastMessageUpdatedAt>t||u&&e.lastMessageUpdatedAt<t)return!1}return l.match(a._deserialize(e),a._sdkState.userId)},index:(0,i.g)(d),backward:u},[4,this.collection.query(e)]):[3,3];case 1:return[4,s.sent().fetch({limit:r})];case 2:return(n=s.sent().map(function(e){return a._deserialize(e)})).forEach(function(e){a._channels.has(e.url)||a._channels.set(e.url,e)}),[2,n];case 3:return[2,[]]}})})},t.prototype.upsert=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r=this;return(0,s.c)(this,function(s){switch(s.label){case 0:if(e.forEach(function(e){if(r._channels.has(e.url)){var t=r._channels.get(e.url);e._pinnedMessagesUpdatedAt<t._pinnedMessagesUpdatedAt&&(e._pinnedMessagesUpdatedAt=t._pinnedMessagesUpdatedAt),Object.assign(t,e,{_iid:r._iid})}else r._channels.set(e.url,e)}),!this.localCacheEnabled)return[3,2];for(n in t=[],e)t.push(this._serialize(e[n],parseInt(n)));return[4,this.collection.upsertMany(t)];case 1:s.sent(),s.label=2;case 2:return[2]}})})},t.prototype.remove=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,i;return(0,s.c)(this,function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),n=(t=(0,s.G)(e)).next(),o.label=1;case 1:return n.done?[3,4]:(r=n.value,this._channels.delete(r),this.localCacheEnabled?[4,this.collection.remove(r)]:[3,3]);case 2:o.sent(),o.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return a={error:o.sent()},[3,7];case 6:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(a)throw a.error}return[7];case 7:return[2]}})})},t.prototype.clear=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.clearMemoryCache=function(){this._channels.clear()},t.prototype._setBlockStateOfAllChannels=function(e,t,n){return(0,s.b)(this,void 0,void 0,function(){var r,a,i,o,u,c,l,h,d,p,_,f,m,v,g,y,b,E,C;return(0,s.c)(this,function(M){switch(M.label){case 0:if(r=[],e===this._sdkState.userId)try{for(i=(a=(0,s.G)(this._channels.values())).next();!i.done;i=a.next()){h=i.value;try{for(v=void 0,u=(o=(0,s.G)(h.members)).next();!u.done;u=o.next())if((_=u.value).userId===t){_.isBlockedByMe=n,r.push(h);break}}catch(e){v={error:e}}finally{try{u&&!u.done&&(g=o.return)&&g.call(o)}finally{if(v)throw v.error}}}}catch(e){f={error:e}}finally{try{i&&!i.done&&(m=a.return)&&m.call(a)}finally{if(f)throw f.error}}else if(t===this._sdkState.userId)try{for(l=(c=(0,s.G)(this._channels.values())).next();!l.done;l=c.next()){h=l.value;try{for(E=void 0,p=(d=(0,s.G)(h.members)).next();!p.done;p=d.next())if((_=p.value).userId===e){_.isBlockingMe=n,r.push(h);break}}catch(e){E={error:e}}finally{try{p&&!p.done&&(C=d.return)&&C.call(d)}finally{if(E)throw E.error}}}}catch(e){y={error:e}}finally{try{l&&!l.done&&(b=c.return)&&b.call(c)}finally{if(y)throw y.error}}return r.length>0?[4,this.upsert(r)]:[3,2];case 1:M.sent(),M.label=2;case 2:return[2]}})})},t.prototype.block=function(e,t){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!0)];case 1:return n.sent(),[2]}})})},t.prototype.unblock=function(e,t){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!1)];case 1:return n.sent(),[2]}})})},t.prototype.markAsRead=function(e,t){return void 0===t&&(t=(0,s.o)([],(0,s.p)(this._channels.keys()),!1)),(0,s.b)(this,void 0,void 0,function(){var n,r,a,i,o,u,c;return(0,s.c)(this,function(l){switch(l.label){case 0:n=[],l.label=1;case 1:l.trys.push([1,6,7,8]),a=(r=(0,s.G)(t)).next(),l.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,this.get(i)]);case 3:(o=l.sent())._updateUnreadMemberState(this._sdkState.userId,e)&&(o._updateUnreadCount(0,0),n.push(o)),l.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return u={error:l.sent()},[3,8];case 7:try{a&&!a.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 8:return n.length>0?[4,this.upsert(n)]:[3,10];case 9:l.sent(),l.label=10;case 10:return[2]}})})},t}(s.T),k={invitedUserIds:null,channelUrl:null,coverUrl:null,coverImage:null,isDistinct:null,isSuper:null,isBroadcast:null,isExclusive:null,isPublic:null,isDiscoverable:null,isStrict:null,isEphemeral:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},x=function(e){return(0,s.l)("string",e.invitedUserIds,!0)&&(0,s.a)("string",e.channelUrl,!0)&&(0,s.a)("string",e.coverUrl,!0)&&((0,s.i)(e.coverImage)||(0,s.a)("string",e.coverImage)||null===e.coverImage)&&(0,s.a)("boolean",e.isDistinct,!0)&&(0,s.a)("boolean",e.isSuper,!0)&&(0,s.a)("boolean",e.isBroadcast,!0)&&(0,s.a)("boolean",e.isExclusive,!0)&&(0,s.a)("boolean",e.isPublic,!0)&&(0,s.a)("boolean",e.isStrict,!0)&&(0,s.a)("boolean",e.isDiscoverable,!0)&&(0,s.a)("boolean",e.isEphemeral,!0)&&(0,s.a)("string",e.accessCode,!0)&&(0,s.a)("string",e.name,!0)&&(0,s.a)("string",e.data,!0)&&(0,s.a)("string",e.customType,!0)&&(0,s.l)("string",e.operatorUserIds,!0)&&(0,s.a)("number",e.messageSurvivalSeconds,!0)},F={customTypes:null,includeEmpty:!1,includeFrozen:!0},P=function(e){return(0,s.l)("string",e.customTypes,!0)&&(0,s.a)("boolean",e.includeEmpty)&&(0,s.a)("boolean",e.includeFrozen)},R={myMemberStateFilter:p.ALL},O=function(e){return(0,s.H)(p,e.myMemberStateFilter)};(eM=w||(w={})).GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",eM.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",eM.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",eM.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",eM.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",eM.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",eM.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",eM.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",eM.SUPER_INVITATION_COUNT="super_group_channel_invitation_count";var V={keys:[]},G={channelCustomTypesFilter:null,superChannelFilter:_.ALL},H={channelUrl:null,scheduledStatus:null,messageTypeFilter:s.a2.ALL},q=function(){function e(e){var t=e.groupChannelCache,n=e.messageCache,r=e.unsentMessageCache,a=e.dispatcher,o=this;this._observers=new Map,a.on(function(e){return(0,s.b)(o,void 0,void 0,function(){var a,o,u,c,l,h,d,p,_,f,m=this;return(0,s.c)(this,function(v){switch(v.label){case 0:if(!(e instanceof i.m))return[3,10];a=e.channels,p=e.source,o=a.filter(function(e){return e instanceof tW}),u=t.filterOffsetChanged(o),v.label=1;case 1:v.trys.push([1,6,7,8]),l=(c=(0,s.G)(u)).next(),v.label=2;case 2:return l.done?[3,5]:(h=l.value,[4,n.removeUnderOffset(h.url,h.messageOffsetTimestamp)]);case 3:v.sent(),v.label=4;case 4:return l=c.next(),[3,2];case 5:return[3,8];case 6:return _={error:v.sent()},[3,8];case 7:try{l&&!l.done&&(f=c.return)&&f.call(c)}finally{if(_)throw _.error}return[7];case 8:return[4,t.upsert(o)];case 9:return v.sent(),this._broadcastUpdateEvent(o,p),[3,15];case 10:return e instanceof i.l?(d=e.channelUrls,p=e.source,[4,t.remove(d)]):[3,13];case 11:return v.sent(),[4,(0,s.F)(function(){return(0,s.b)(m,void 0,void 0,function(){var e,t,a,i,o;return(0,s.c)(this,function(u){switch(u.label){case 0:u.trys.push([0,6,7,8]),t=(e=(0,s.G)(d)).next(),u.label=1;case 1:return t.done?[3,5]:(a=t.value,[4,n.removeMessagesOfChannel(a)]);case 2:return u.sent(),[4,r.removeMessagesOfChannel(a)];case 3:u.sent(),u.label=4;case 4:return t=e.next(),[3,1];case 5:return[3,8];case 6:return i={error:u.sent()},[3,8];case 7:try{t&&!t.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}})})})];case 12:return v.sent(),this._broadcastRemoveEvent(d,p),[3,15];case 13:return e instanceof i.D?[4,t.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,15];case 14:v.sent(),v.label=15;case 15:return[2]}})})})}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var a=(0,s.G)(this._observers.values()),i=a.next();!i.done;i=a.next())i.value.onUpdate(e,t)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var a=(0,s.G)(this._observers.values()),i=a.next();!i.done;i=a.next())i.value.onRemove(e,t)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e.prototype.unsubscribeAll=function(){this._observers.clear()},e}(),B=function(){function e(e){var t=e.cacheContext,n=e.messageCache,r=e.unsentMessageCache,a=e.dispatcher,i=e.logger,o=this;this._cacheContext=null,this._observers=new Map,this._logger=null,this._cacheContext=t,this._logger=i,a.on(function(e){return(0,s.b)(o,void 0,void 0,function(){var t,a,i,o,c,l,h,d,p,_,f,m,v=this;return(0,s.c)(this,function(g){switch(g.label){case 0:return e instanceof s.ae?(t=e.messages,f=e.source,a=t.filter(function(e){return e.messageId>0}),i=t.filter(function(e){return 0===e.messageId}),a.length>0?[4,(0,s.F)(function(){return(0,s.b)(v,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,n.upsert(a)];case 1:return e.sent(),[4,r.remove(a.map(function(e){return e instanceof u.S?e.reqId:null}).filter(function(e){return null!==e}))];case 2:return e.sent(),[2]}})})})]:[3,2]):[3,5];case 1:g.sent(),this._broadcastUpdateEvent(a,f),g.label=2;case 2:return i.length>0?[4,(0,s.F)(function(){return(0,s.b)(v,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,r.upsert(i)];case 1:return e.sent(),[2]}})})})]:[3,4];case 3:g.sent(),this._broadcastUpdateEvent(i,f),g.label=4;case 4:return[3,21];case 5:return e instanceof s.af?(o=e.messageIds,f=e.source,[4,(0,s.F)(function(){return(0,s.b)(v,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,n.remove(o)];case 1:return e.sent(),[2]}})})})]):[3,7];case 6:return g.sent(),this._broadcastRemoveEvent(o,f),[3,21];case 7:return e instanceof s.aB?(c=e.reqId,f=e.source,[4,(0,s.F)(function(){return(0,s.b)(v,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,r.remove([c])];case 1:return e.sent(),[2]}})})})]):[3,9];case 8:return g.sent(),this._broadcastRemoveUnsentEvent(c,f),[3,21];case 9:return e instanceof s.as?(l=e.polls,f=e.source,this._cacheContext.localCacheEnabled?[4,Promise.all(l.map(function(e){return e.messageId}).map(function(e){return n.get(e)}))]:[3,12]):[3,13];case 10:return(h=g.sent().filter(function(e){return e})).length>0&&l.forEach(function(e){var t=h.find(function(t){return t.messageId===e.messageId});t&&t.applyPoll(e)}),[4,(0,s.F)(function(){return(0,s.b)(v,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,n.upsert(h)];case 1:return[2,e.sent()]}})})})];case 11:g.sent(),g.label=12;case 12:return this._broadcastPollChangeLogEvent(l,f),[3,21];case 13:return e instanceof s.aA?(d=e.event,f=e.source,[4,n.get(d.messageId)]):[3,17];case 14:return(p=g.sent())&&p.isUserMessage()&&p.poll&&p.poll.applyPollUpdateEvent(d)?[4,(0,s.F)(function(){return(0,s.b)(v,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,n.upsert([p])];case 1:return[2,e.sent()]}})})})]:[3,16];case 15:g.sent(),g.label=16;case 16:return this._broadcastPollUpdateEvent(d,f),[3,21];case 17:return e instanceof s.ay?(_=e.event,f=e.source,[4,n.get(_.messageId)]):[3,21];case 18:return(m=g.sent())&&m.isUserMessage()&&m.poll&&m.poll.applyPollVoteEvent(_)?[4,(0,s.F)(function(){return(0,s.b)(v,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,n.upsert([m])];case 1:return[2,e.sent()]}})})})]:[3,20];case 19:g.sent(),g.label=20;case 20:this._broadcastPollVoteEvent(_,f),g.label=21;case 21:return[2]}})})})}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var a=(0,s.G)(this._observers.values()),i=a.next();!i.done;i=a.next())i.value.onUpdate(e,t)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},e.prototype._broadcastPollChangeLogEvent=function(e,t){var n,r;try{for(var a=(0,s.G)(this._observers.values()),i=a.next();!i.done;i=a.next())i.value.onPollChangeLogUpdate(e,t)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},e.prototype._broadcastPollUpdateEvent=function(e,t){var n,r;try{for(var a=(0,s.G)(this._observers.values()),i=a.next();!i.done;i=a.next())i.value.onPollUpdate(e,t)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},e.prototype._broadcastPollVoteEvent=function(e,t){var n,r;try{for(var a=(0,s.G)(this._observers.values()),i=a.next();!i.done;i=a.next())i.value.onPollVote(e,t)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var a=(0,s.G)(this._observers.values()),i=a.next();!i.done;i=a.next())i.value.onRemove(e,t)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveUnsentEvent=function(e,t){var n,r;try{for(var a=(0,s.G)(this._observers.values()),i=a.next();!i.done;i=a.next())i.value.onRemoveUnsent(e,t)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e.prototype.unsubscribeAll=function(){this._observers.clear()},e}(),z=function(e){function t(t){var n=t.userId,r=t.ts,a=t.token,i=t.filter,o=e.call(this)||this,u=(0,s.g)((0,s.g)({},F),i),c=u.customTypes,l=u.includeEmpty,h=u.includeFrozen;return o.method=s.A.GET,o.path="".concat(s.d,"/").concat(encodeURIComponent(n),"/my_group_channels/changelogs"),o.params=(0,s.e)({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:r>0?r:null,token:a,custom_types:c,show_empty:l,show_frozen:h}),o}return(0,s._)(t,e),t}(s.f),j=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.updatedChannels=n.updated.map(function(e){return new tW(t,e)}),r.deletedChannelUrls=n.deleted,r.hasMore=n.has_more,r.token=n.next,r}return(0,s._)(t,e),t}(s.h),W=function(e){function t(t){var n=t.channelUrl,r=t.isInternalCall,a=e.call(this)||this;return a.method=s.A.GET,a.path="".concat(r?s.aC:s.ac,"/").concat(encodeURIComponent(n)),a.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},a}return(0,s._)(t,e),t}(s.f),Q=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=null,r.channel=new tW(t,n),r}return(0,s._)(t,e),t}(s.h),K=function(e){function t(t){var n=this,r=t.userId,a=t.token,i=t.limit,o=t.order,u=t.includeEmpty,c=t.myMemberStateFilter,l=t.superChannelFilter,h=t.publicChannelFilter,d=t.unreadChannelFilter,p=t.nicknameContainsFilter,_=t.nicknameStartsWithFilter,f=t.nicknameExactMatchFilter,m=t.channelNameContainsFilter,v=t.channelUrlsFilter,g=t.customTypesFilter,y=t.customTypeStartsWithFilter,b=t.hiddenChannelFilter,E=t.metadataOrderKeyFilter,C=t.metadataKey,M=t.metadataValues,N=t.metadataValueStartsWith,S=t.includeFrozen,U=t.includeMetaData,A=t.searchFilter,I=t.userIdsFilter;return(n=e.call(this)||this).method=s.A.GET,n.path="".concat(s.d,"/").concat(encodeURIComponent(r),"/my_group_channels"),n.params=(0,s.e)({token:a,limit:i,order:o,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:u,member_state_filter:c,super_mode:l,public_mode:h,unread_filter:d,members_nickname_contains:p,members_nickname_startswith:_,members_nickname:f,name_contains:m,channel_urls:v,custom_types:g,custom_type_startswith:y,hidden_mode:b,metadata_order_key:E,metadata_key:C,metadata_values:M,metadata_value_startswith:N,show_frozen:S,show_metadata:U}),A&&A.query&&A.fields&&(n.params.search_query=A.query,n.params.search_fields=A.fields),I&&I.userIds&&I.userIds.length>0&&(I.includeMode?(n.params.members_include_in=I.userIds,n.params.query_type=I.queryType.toUpperCase()):n.params.members_exactly_in=I.userIds),n}return(0,s._)(t,e),t}(s.f),Y=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.channels=[],r.ts=null;var s=n.next,a=n.channels,i=n.ts;return r.token=s,a&&a.length>0&&(r.channels=a.map(function(e){return e.ts=i,new tW(t,e)})),r.ts=null!=i?i:null,r}return(0,s._)(t,e),t}(s.h),J=function(e){function t(t){var n=t.userId,r=t.filter,a=e.call(this)||this,i=r.myMemberStateFilter;return a.method=s.A.GET,a.path="".concat(s.d,"/").concat(encodeURIComponent(n),"/group_channel_count"),a.params={state:null!=i?i:p.ALL},a}return(0,s._)(t,e),t}(s.f),X=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.groupChannelCount=n.group_channel_count,r}return(0,s._)(t,e),t}(s.h),Z=function(e){function t(t){var n=t.userId,r=t.filter,a=e.call(this)||this,i=r.keys;return a.method=s.A.GET,a.path="".concat(s.d,"/").concat(encodeURIComponent(n),"/unread_item_count"),a.params={item_keys:i},a}return(0,s._)(t,e),t}(s.f),$=function(e){function t(t,n){var r=e.call(this,t,n)||this;return"number"==typeof n[w.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(r.groupChannelUnreadMentionCount=n[w.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof n[w.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(r.groupChannelUnreadMessageCount=n[w.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof n[w.GROUP_CHANNEL_INVITATION_COUNT]&&(r.groupChannelInvitationCount=n[w.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof n[w.SUPER_UNREAD_MENTION_COUNT]&&(r.superGroupChannelUnreadMentionCount=n[w.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[w.SUPER_UNREAD_MESSAGE_COUNT]&&(r.superGroupChannelUnreadMessageCount=n[w.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[w.SUPER_INVITATION_COUNT]&&(r.superGroupChannelInvitationCount=n[w.SUPER_INVITATION_COUNT]),"number"==typeof n[w.NONSUPER_UNREAD_MENTION_COUNT]&&(r.nonSuperGroupChannelUnreadMentionCount=n[w.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[w.NONSUPER_UNREAD_MESSAGE_COUNT]&&(r.nonSuperGroupChannelUnreadMessageCount=n[w.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[w.NONSUPER_INVITATION_COUNT]&&(r.nonSuperGroupChannelInvitationCount=n[w.NONSUPER_INVITATION_COUNT]),r}return(0,s._)(t,e),t}(s.h),ee=function(e){function t(t){var n=t.userId,r=e.call(this)||this;return r.method=s.A.GET,r.path="".concat(s.d,"/").concat(encodeURIComponent(n),"/unread_channel_count"),r}return(0,s._)(t,e),t}(s.f),et=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.unreadCount=n.unread_count,r}return(0,s._)(t,e),t}(s.h),en=function(e){function t(t){var n=t.userId,r=t.filter,a=e.call(this)||this,i=r.channelCustomTypesFilter,o=r.superChannelFilter;return a.method=s.A.GET,a.path="".concat(s.d,"/").concat(encodeURIComponent(n),"/unread_message_count"),a.params={super_mode:null!=o?o:_.ALL,custom_types:i},a}return(0,s._)(t,e),t}(s.f),er=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.unreadCount=n.unread_count,r}return(0,s._)(t,e),t}(s.h),es=function(e){function t(t){var n=t.channelUrl,r=t.scheduledStatus,a=t.messageTypeFilter,i=e.call(this)||this;return i.method=s.A.GET,i.path="".concat(s.aD,"/count"),i.params={channel_url:n,status:ei(r)},a&&(i.params.message_type=a),i}return(0,s._)(t,e),t}(s.f),ea=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.count=n.count,r}return(0,s._)(t,e),t}(s.h),ei=function(e){if(e){var t=[];return e.forEach(function(e){switch(e){case u.j.PENDING:t.push(u.I.PENDING);break;case u.j.SENT:t.push(u.I.IN_QUEUE),t.push(u.I.SENT);break;case u.j.CANCELED:t.push(u.I.CANCELED);break;case u.j.FAILED:t.push(u.I.FAILED)}}),t}},eo=function(e){function t(t){var n=this,r=t.userId,a=t.channelUrl,i=t.coverUrl,o=t.coverImage,u=t.isDistinct,c=t.isSuper,l=t.isBroadcast,h=t.isPublic,d=t.isExclusive,p=t.isDiscoverable,_=t.isStrict,f=t.isEphemeral,m=t.accessCode,v=t.name,g=t.data,y=t.customType,b=t.messageSurvivalSeconds,E=t.invitedUserIds,C=t.operatorUserIds;return(n=e.call(this)||this).method=s.A.POST,n.path=s.ac,n.params=(0,s.e)({user_ids:(0,s.o)([r],(0,s.p)(null!=E?E:[]),!1).filter(function(e,t,n){return t===n.indexOf(e)}),channel_url:a,cover_url:i,cover_file:o,is_distinct:u,is_super:c,is_broadcast:l,is_exclusive:d,is_public:h,is_discoverable:p,strict:_,is_ephemeral:f,access_code:m,name:v,data:g,custom_type:y,operator_ids:C,message_survival_seconds:b}),n}return(0,s._)(t,e),t}(s.f),eu=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new tW(t,n),r.isCreated=n.is_created,r}return(0,s._)(t,e),t}(s.h),ec=function(e){function t(t){var n=t.userId,r=t.channelUrls,a=e.call(this)||this;return a.method=s.A.PUT,a.path="".concat(s.d,"/").concat(encodeURIComponent(n),"/mark_as_read_all"),a.params={channel_urls:r},a}return(0,s._)(t,e),t}(s.f);eN=s.h,(0,s._)(function(){return null!==eN&&eN.apply(this,arguments)||this},eN);var el=function(e){function t(t){var n=this,r=t.channelUrl,a=t.userId,i=t.accessCode;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r),"/join"),n.params={user_id:a,access_code:i},n}return(0,s._)(t,e),t}(s.f),eh=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new tW(t,n),r}return(0,s._)(t,e),t}(s.h),ed=function(e){function t(t,n,r){var s=e.call(this,t,n,r)||this,a=r.data,i=a.member_count,o=a.joined_member_count,u=a.users,c=void 0===u?null:u;return s.memberCount=void 0===i?null:i,s.joinedMemberCount=void 0===o?null:o,s.members=Array.isArray(c)?c.map(function(e){return new b(t,e)}):[new b(t,r.data)],s}return(0,s._)(t,e),t}(o.C),ep=function(e){function t(t){var n=this,r=t.channelUrl,a=t.userId,i=t.shouldRemoveOperatorStatus;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r),"/leave"),n.params={user_id:a,should_remove_operator_status:i},n}return(0,s._)(t,e),t}(s.f);eS=s.h,(0,s._)(function(e,t){return eS.call(this,e,t)||this},eS);var e_=function(e){function t(t,n,r){var s=e.call(this,t,n,r)||this,a=r.data,i=a.member_count,o=a.joined_member_count;return s.memberCount=void 0===i?null:i,s.joinedMemberCount=void 0===o?null:o,s.member=new b(s._iid,r.data),s}return(0,s._)(t,e),t}(o.C),ef=function(e){function t(t){var n=this,r=t.channelUrl,a=t.userIds;return(n=e.call(this)||this).method=s.A.POST,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r),"/invite"),n.params={user_ids:a},n}return(0,s._)(t,e),t}(s.f),em=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new tW(t,n),r}return(0,s._)(t,e),t}(s.h),ev=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this,i=r.data,o=i.member_count,u=i.joined_member_count,c=i.inviter,l=void 0===c?null:c,h=i.invitees;return a.memberCount=void 0===o?null:o,a.joinedMemberCount=void 0===u?null:u,a.inviter=l?new s.U(t,l):null,a.invitees=(void 0===h?[]:h).map(function(e){return new b(t,e)}),a}return(0,s._)(t,e),t}(o.C),eg=function(e){function t(t){var n=this,r=t.channelUrl,a=t.userId;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r),"/decline"),n.params={user_id:a},n}return(0,s._)(t,e),t}(s.f);eU=s.h,(0,s._)(function(e,t){var n=eU.call(this,e,t)||this;return n.channel=new tW(e,t),n.channel.myMemberState=h.NONE,n},eU);var ey=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this,i=r.data,o=i.member_count,u=i.joined_member_count,c=i.inviter,l=void 0===c?null:c,h=i.invitee,d=void 0===h?null:h;return a.memberCount=void 0===o?null:o,a.joinedMemberCount=void 0===u?null:u,a.inviter=l?new s.U(t,l):null,a.invitee=d?new b(t,d):null,a}return(0,s._)(t,e),t}(o.C),eb=function(e){function t(t){var n=t.channelUrl;return e.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n}})||this}return(0,s._)(t,e),t}(s.a5),eE=function(e){function t(t,n,r){var s=e.call(this,t,"READ",r)||this;return s.readStatus=new E(t,r),s}return(0,s._)(t,e),t}(s.W),eC=function(e){function t(t){var n=t.channelUrl,r=t.userId,a=e.call(this)||this;return(a=e.call(this)||this).method=s.A.PUT,a.path="".concat(s.ac,"/").concat(encodeURIComponent(n),"/messages/mark_as_delivered"),a.params=(0,s.e)({userId:r}),a}return(0,s._)(t,e),t}(s.f);eA=s.h,(0,s._)(function(){return null!==eA&&eA.apply(this,arguments)||this},eA);var eM,eN,eS,eU,eA,eI,eT=function(e){function t(t,n,r){var s=e.call(this,t,"DLVR",r)||this;return s.channelUrl=r.channel_url,s.deliveredStateUpdate=r.updated,s}return(0,s._)(t,e),t}(s.W),ew=function(e){function t(t){var n=this,r=t.channelUrl,a=t.userId,i=t.hidePreviousMessages,o=t.allowAutoUnhide;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r),"/hide"),n.params={user_id:a,hide_previous_messages:i,allow_auto_unhide:o},n}return(0,s._)(t,e),t}(s.f),eD=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.messageOffsetTimestamp=null;var s=n.ts_message_offset;return r.messageOffsetTimestamp=null!=s?s:null,r}return(0,s._)(t,e),t}(s.h),eL=function(e){function t(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.allowAutoUnhide=null,s.hidePreviousMessages=null,s.messageOffsetTimestamp=null,r.data&&(s.allowAutoUnhide=r.data.allow_auto_unhide,s.hidePreviousMessages=r.data.hide_previous_messages),s.messageOffsetTimestamp=r.ts_message_offset,s}return(0,s._)(t,e),t}(s.W),ek=function(e){function t(t){var n=t.channelUrl,r=t.time;return e.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return(0,s._)(t,e),t}(s.a5),ex=function(e){function t(t,n,r){var a=e.call(this,t,"SYEV",r)||this;return a.user=new s.U(t,r.data),a}return(0,s._)(t,e),t}(s.W),eF=function(e){function t(t){var n=t.channelUrl,r=t.time;return e.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return(0,s._)(t,e),t}(s.a5),eP=function(e){function t(t,n,r){var a=e.call(this,t,"SYEV",r)||this;return a.user=new s.U(t,r.data),a}return(0,s._)(t,e),t}(s.W),eR=function(e){function t(t){var n=t.channelUrl,r=t.messageId;return e.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:n,msg_id:r}})||this}return(0,s._)(t,e),t}(s.a5),eO=function(e){function t(t,n){var r,s,a,o,u,c,l,h,v,y,b,E,C,M,N,S,U,A,I,T,w,D,L=this;return(L=e.call(this,t,n)||this).includeEmpty=!1,L.includeFrozen=!0,L.includeMetaData=!0,L.channelUrlsFilter=null,L.customTypesFilter=null,L.customTypeStartsWithFilter=null,L.nicknameContainsFilter=null,L.nicknameStartsWithFilter=null,L.nicknameExactMatchFilter=null,L.channelNameContainsFilter="",L.myMemberStateFilter=p.ALL,L.unreadChannelFilter=f.ALL,L.superChannelFilter=_.ALL,L.publicChannelFilter=d.ALL,L.hiddenChannelFilter=m.UNHIDDEN,L.searchFilter={fields:[],query:null},L.userIdsFilter={userIds:[],includeMode:!0,queryType:g.AND},L.metadataKey=null,L.metadataValues=null,L.metadataOrderKeyFilter=null,L.metadataValueStartsWith=null,L.order=i.G.LATEST_LAST_MESSAGE,L.includeEmpty=null!==(r=n.includeEmpty)&&void 0!==r&&r,L.includeFrozen=null===(s=n.includeFrozen)||void 0===s||s,L.includeMetaData=null===(a=n.includeMetaData)||void 0===a||a,L.channelUrlsFilter=null!==(o=n.channelUrlsFilter)&&void 0!==o?o:null,L.customTypesFilter=null!==(u=n.customTypesFilter)&&void 0!==u?u:null,L.customTypeStartsWithFilter=null!==(c=n.customTypeStartsWithFilter)&&void 0!==c?c:"",L.nicknameContainsFilter=null!==(l=n.nicknameContainsFilter)&&void 0!==l?l:null,L.nicknameStartsWithFilter=null!==(h=n.nicknameStartsWithFilter)&&void 0!==h?h:null,L.nicknameExactMatchFilter=null!==(v=n.nicknameExactMatchFilter)&&void 0!==v?v:null,L.channelNameContainsFilter=null!==(y=n.channelNameContainsFilter)&&void 0!==y?y:"",L.myMemberStateFilter=null!==(b=n.myMemberStateFilter)&&void 0!==b?b:p.ALL,L.unreadChannelFilter=null!==(E=n.unreadChannelFilter)&&void 0!==E?E:f.ALL,L.superChannelFilter=null!==(C=n.superChannelFilter)&&void 0!==C?C:_.ALL,L.publicChannelFilter=null!==(M=n.publicChannelFilter)&&void 0!==M?M:d.ALL,L.hiddenChannelFilter=null!==(N=n.hiddenChannelFilter)&&void 0!==N?N:m.UNHIDDEN,L.searchFilter=null!==(S=n.searchFilter)&&void 0!==S?S:{fields:[],query:null},L.userIdsFilter=null!==(U=n.userIdsFilter)&&void 0!==U?U:{userIds:[],includeMode:!0,queryType:g.AND},L.metadataKey=null!==(A=n.metadataKey)&&void 0!==A?A:null,L.metadataValues=null!==(I=n.metadataValues)&&void 0!==I?I:null,L.metadataOrderKeyFilter=null!==(T=n.metadataOrderKeyFilter)&&void 0!==T?T:null,L.metadataValueStartsWith=null!==(w=n.metadataValueStartsWith)&&void 0!==w?w:null,L.order=null!==(D=n.order)&&void 0!==D?D:i.G.LATEST_LAST_MESSAGE,L}return(0,s._)(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&(0,s.a)("boolean",this.includeEmpty)&&(0,s.a)("boolean",this.includeFrozen)&&(0,s.a)("boolean",this.includeMetaData)&&(0,s.a)("string",this.channelNameContainsFilter)&&(0,s.l)("string",this.channelUrlsFilter,!0)&&(0,s.l)("string",this.customTypesFilter,!0)&&(0,s.a)("string",this.customTypeStartsWithFilter)&&(0,s.a)("string",this.nicknameContainsFilter,!0)&&(0,s.a)("string",this.nicknameStartsWithFilter,!0)&&(0,s.a)("string",this.nicknameExactMatchFilter,!0)&&(0,s.H)(p,this.myMemberStateFilter)&&(0,s.H)(_,this.superChannelFilter)&&(0,s.H)(d,this.publicChannelFilter)&&(0,s.H)(f,this.unreadChannelFilter)&&(0,s.H)(m,this.hiddenChannelFilter)&&(0,s.l)(y,this.searchFilter.fields)&&(0,s.a)("string",this.searchFilter.query,!0)&&(0,s.l)("string",this.userIdsFilter.userIds)&&(0,s.a)("boolean",this.userIdsFilter.includeMode)&&(0,s.H)(g,this.userIdsFilter.queryType)&&(0,s.H)(i.G,this.order)&&(0,s.a)("string",this.metadataOrderKeyFilter,!0)&&(0,s.a)("string",this.metadataKey,!0)&&(0,s.l)("string",this.metadataValues,!0)&&(0,s.a)("string",this.metadataValueStartsWith,!0)},t.prototype.serialize=function(){return(0,s.Z)(this)},t.prototype.next=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n;return(0,s.c)(this,function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,eq.of(this._iid).getMyGroupChannels(this._token,this,this.limit)]):[3,2]:[3,5];case 1:return t=(e=r.sent()).channels,n=e.token,this._token=n,this._hasNext=!!n,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw s.S.queryInProgress;case 4:return[3,6];case 5:throw s.S.invalidParameters;case 6:return[2]}})})},t}(s.B),eV=function(){function e(e){var t=e.top,n=void 0===t?Number.MAX_SAFE_INTEGER:t,r=e.bottom;this.top=n,this.bottom=void 0===r?0:r}return e.prototype.includes=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.every(function(t){return e.top<=t&&t<=e.bottom})},e.prototype.overlap=function(e){return this.includes(e.top)||this.includes(e.bottom)},e.prototype.intersect=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.some(function(t){return e.top<=t&&t<=e.bottom})},e.prototype.extends=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.top=Math.min.apply(Math,(0,s.o)([this.top],(0,s.p)(e),!1)),this.bottom=Math.max.apply(Math,(0,s.o)([this.bottom],(0,s.p)(e),!1))},e}(),eG=function(e){function t(t,n,r){var a,i=this;return(i=e.call(this,t,"SYEV",r)||this).pinnedMessageIds=[],i.latestPinnedMessage=null,i.ts=0,r.data&&(i.pinnedMessageIds=null!==(a=r.data.pinned_message_ids)&&void 0!==a?a:[],i.latestPinnedMessage=r.data.latest_pinned_message?(0,u.p)(t,(0,s.g)({},r.data.latest_pinned_message)):null),i.ts=r.ts,i}return(0,s._)(t,e),t}(s.W),eH={},eq=function(){function e(e,t){var n=t.sdkState,r=t.cacheContext,a=t.dispatcher,o=t.sessionManager,c=t.requestQueue,l=t.logger,h=t.disableMack,d=this;return this._leftChannels=new Map,this._disableMack=!1,this._markAsReadAllLastSentAt=0,eH[e]||(this._iid=e,this._sdkState=n,this._sessionManager=o,this._requestQueue=c,this._dispatcher=a,this._logger=l,this._disableMack=void 0!==h&&h,this._groupChannelHandlers=new Map,this._groupChannelCache=new L(this._iid,{sdkState:n,cacheContext:r}),this._unsentMessageCache=new i.j(this._iid,{sdkState:n,cacheContext:r}),this._messageCache=new i.i(this._iid,{sdkState:n,cacheContext:r,unsentMessageCache:this._unsentMessageCache}),this._groupChannelBroadcast=new q({groupChannelCache:this._groupChannelCache,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:a}),this._messageBroadcast=new B({cacheContext:r,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:a,logger:l}),setInterval(function(){var e,t,n=function(e){e.invalidateTypingStatus()&&(d._dispatcher.dispatch(new i.m({channels:[e],source:i.n.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),d._groupChannelHandlers.forEach(function(t){t.onTypingStatusUpdated(e)}))};try{for(var r=(0,s.G)(d._groupChannelCache.channels),a=r.next();!a.done;a=r.next())n(a.value)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},1e3),this._dispatcher.on(function(e){e instanceof s.W?d._handleEvent(e):e instanceof i.o?(0,s.b)(d,void 0,void 0,function(){var t,n;return(0,s.c)(this,function(r){switch(r.label){case 0:return t=e.message,[4,this.getChannel(t.channelUrl,!0)];case 1:return n=r.sent(),t instanceof u.U?n._autoResendUserMessage(t):t instanceof u.F&&n._autoResendFileMessage(t),[2]}})}):e instanceof i.R&&d.reduceDBSize()}),eH[e]=this),eH[e]}return e.of=function(e){return eH[e]},e.clear=function(e){eH[e]&&delete eH[e]},Object.defineProperty(e.prototype,"handlers",{get:function(){return(0,s.o)([],(0,s.p)(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),e.prototype.buildGroupChannelFromSerializedData=function(e){var t=(0,s.r)(e);return new tW(this._iid,tW.payloadify(t))},e.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var t=(0,s.r)(e);return new eO(this._iid,t)},e.prototype.buildMemberFromSerializedData=function(e){var t=(0,s.r)(e);return new b(this._iid,b.payloadify(t))},e.prototype.getChannelFromCache=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,t.sent()]}})})},e.prototype.getChannelsFromCache=function(e,t,n,r){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(s){switch(s.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:t,order:n,limit:r})];case 1:return[2,s.sent()]}})})},e.prototype.upsertChannelsToCache=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this._groupChannelCache.upsert(e)];case 1:return t.sent(),[2]}})})},e.prototype.removeChannelsFromCache=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this._groupChannelCache.remove(e)];case 1:return t.sent(),[2]}})})},e.prototype.clearChannelsFromCache=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,this._groupChannelCache.clear()];case 1:return e.sent(),[2]}})})},e.prototype.reduceDBSize=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,u,c,l,h,d,p,_;return(0,s.c)(this,function(f){switch(f.label){case 0:return t=(e=s.V.of(this._iid).cacheContext).localCacheConfig,n=e.nestdb,e.localCacheEnabled&&n&&n.state==i.k.OPENED?(r=1024*t.maxSize*1024,[4,n.estimateUsage()]):[2];case 1:if((a=f.sent())<r)return[2];o=[],u=this._groupChannelCache.channels,c={},p=0,f.label=2;case 2:return p<u.length?[4,this.getMessagesFromCache(u[p].url,0,"prev",new i.p)]:[3,5];case 3:l=f.sent(),c[u[p].url]=JSON.stringify(l).length,h=new s.M({channel:u[p],cachedMessageCount:l.length}),o.push(h),f.label=4;case 4:return p++,[3,2];case 5:d=o.sort(t.clearOrderComparator),p=0,f.label=6;case 6:return p<d.length?[4,this._messageCache.removeMessagesOfChannel(d[p].channel.url)]:[3,10];case 7:return f.sent(),[4,this._messageCache._getGroupChannelPreferenceSize(d[p].channel.url)];case 8:if(_=f.sent(),(a-=c[d[p].channel.url]+_)<r)return[3,10];f.label=9;case 9:return p++,[3,6];case 10:return[2]}})})},e.prototype._handleEvent=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,c,l,d,p,_,f,m,v,g,y,b,E,C,M,N,S,U,A,I,T,w,D,L,k,x,F,P,R,O,V,G,H,q,B,z,j,W,Q,K,Y,J,X,Z,$,ee,et,en,er,es,ea,ei,eo,eu,ec,el,eh,ep,ef,em,eg,eb,eC,eM,eN,eS,eU,eA,eI,ew,eD,ek,eF,eO,eV,eH,eq,eB,ez,ej,eW,eQ,eK,eY,eJ,eX,eZ,e$,e0,e1,e2,e3,e4,e7,e5,e6,e8,e9,te,tt,tn,tr,ts,ta,ti,to,tu,tc,tl,th,td,tp,t_,tf,tm,tv,tg,ty,tb,tE,tC,tM,tN,tS,tU,tA,tI,tT,tw,tD,tL,tk,tx,tF=this;return(0,s.c)(this,function(tP){switch(tP.label){case 0:switch(tP.trys.push([0,78,,79]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,19];case"MCNT":return[3,23];case"PEDI":return[3,32];case"VOTE":return[3,34];case"SYEV":return[3,36];case"USEV":return[3,76]}return[3,77];case 1:return _=null,"MESG"===e.code?_=e.as(a.C):"FILE"===e.code?_=e.as(u.k):"ADMM"!==e.code&&"BRDM"!=e.code||(_=e.as(o.A)),_?(t=_.message,n=_.isMentioned,r=_.forceUpdateLastMessage,t.channelType!==s.K.GROUP?[3,3]:(this._disableMack||(0,s.F)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e;return(0,s.c)(this,function(n){return e=new eR(t),this._requestQueue.send(e),[2]})})}),w=this._groupChannelCache.isCachedInMemory(t.channelUrl),g=t instanceof u.S&&t.sender.userId===this._sdkState.userId,[4,this.getChannel(t.channelUrl,!0)])):[3,3];case 2:if((c=tP.sent()).hiddenState===tV.HIDDEN_ALLOW_AUTO_UNHIDE&&(c.hiddenState=tV.UNHIDDEN),t instanceof u.S){l=s.V.of(this._iid).useMemberInfoInMessage;try{for(p=(d=(0,s.G)(c.members)).next();!p.done;p=d.next())if((eX=p.value).userId===t.sender.userId){l||(t.sender.nickname=eX.nickname,t.sender.plainProfileUrl=eX.plainProfileUrl,t.sender.metaData=eX.metaData,t.sender.isBlockedByMe=eX.isBlockedByMe);break}}catch(e){tS={error:e}}finally{try{p&&!p.done&&(tU=d.return)&&tU.call(d)}finally{if(tS)throw tS.error}}!l&&n&&t.mentionedUsers.forEach(function(e){var t,n;try{for(var r=(0,s.G)(c.members),a=r.next();!a.done;a=r.next()){var i=a.value;if(e.userId===i.userId){e.nickname=i.nickname,e.plainProfileUrl=i.plainProfileUrl,e.metaData=i.metaData;break}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}),g&&(b=this._sessionManager.currentUser)&&(b.nickname=t.sender.nickname,b.plainProfileUrl=t.sender.plainProfileUrl,b.metaData=t.sender.metaData)}t.silent&&!g||(c.isEphemeral||w)&&((!c.lastMessage||c.lastMessage.createdAt<t.createdAt)&&(c.lastMessage=t),g||c._updateUnreadCount(c.unreadMessageCount+1,c.unreadMentionCount+(n?1:0))),r&&(!c.lastMessage||c.lastMessage.createdAt<t.createdAt)&&(c.lastMessage=t),this._dispatcher.dispatch(new i.m({channels:[c],source:i.n.EVENT_MESSAGE_RECEIVED})),t.silent&&!g||(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelChanged(c)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),this._dispatcher.dispatch(new s.ae({messages:[t],source:s.ad.EVENT_MESSAGE_RECEIVED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,r,a,i,o;return(0,s.c)(this,function(u){try{for(r=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!r.done;r=e.next())(a=r.value).onMessageReceived(c,t),n&&a.onMentionReceived(c,t)}catch(e){i={error:e}}finally{try{r&&!r.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}}return[2]})})}),tP.label=3;case 3:return[3,77];case 4:return _=null,"MEDI"===e.code?_=e.as(a.z):"FEDI"===e.code?_=e.as(a.A):"AEDI"===e.code&&(_=e.as(o.U)),_?(f=_.message,m=_.mentionCountChange,f.channelType!==s.K.GROUP?[3,6]:(w=this._groupChannelCache.isCachedInMemory(f.channelUrl),[4,this.getChannel(f.channelUrl,!0)])):[3,6];case 5:v=tP.sent(),g=f instanceof u.S&&f.sender.userId===this._sdkState.userId,y=!1,g?(b=this._sessionManager.currentUser)&&(b.nickname=f.sender.nickname,b.plainProfileUrl=f.sender.plainProfileUrl,b.metaData=f.sender.metaData):v.isReadMessage(f)||0!==m&&!f.silent&&w&&(v._updateUnreadCount(v.unreadMessageCount,v.unreadMentionCount+m),y=!0),!v.lastMessage||v.lastMessage.createdAt<f.createdAt?(v.lastMessage=f,y=!0):v.lastMessage.isIdentical(f)&&(w?v.lastMessage.updatedAt<f.updatedAt&&(v.lastMessage=f,y=!0):y=!0),E=!1,v.lastPinnedMessage&&v.lastPinnedMessage.messageId===f.messageId&&(v.lastPinnedMessage=f,y=!0,E=!0),y&&(this._dispatcher.dispatch(new i.m({channels:[v],source:E?i.n.EVENT_PINNED_MESSAGE_UPDATED:i.n.EVENT_MESSAGE_UPDATED})),f.silent&&!g||(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelChanged(v)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),E&&(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onPinnedMessageUpdated(v)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})),this._dispatcher.dispatch(new s.ae({messages:[f],source:s.ad.EVENT_MESSAGE_UPDATED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r,a;return(0,s.c)(this,function(i){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())(n=t.value).onMessageUpdated(v,f),0!==m&&n.onMentionReceived(v,f)}catch(e){r={error:e}}finally{try{t&&!t.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]})})}),tP.label=6;case 6:return[3,77];case 7:return Z=(C=e.as(a.y)).channelUrl,$=C.channelType,M=C.messageId,$!==s.K.GROUP?[3,9]:[4,this.getChannel(Z,!0)];case 8:N=tP.sent(),this._dispatcher.dispatch(new s.af({messageIds:[M],source:s.ad.EVENT_MESSAGE_DELETED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onMessageDeleted(N,M)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),tP.label=9;case 9:return[3,77];case 10:return(S=e.as(eE).readStatus).channelType!==s.K.GROUP?[3,12]:(w=this._groupChannelCache.isCachedInMemory(S.channelUrl),[4,this.getChannel(S.channelUrl,!0)]);case 11:U=tP.sent(),w&&U._updateUnreadMemberState(S.reader.userId,S.readAt),S.reader.userId===this._sdkState.userId?w?(U.unreadMessageCount>0||U.unreadMentionCount>0)&&(U._updateUnreadCount(0,0),this._dispatcher.dispatch(new i.m({channels:[U],source:i.n.EVENT_CHANNEL_READ})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelChanged(U)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})):0!==U.unreadMessageCount&&0!==U.unreadMentionCount||(this._dispatcher.dispatch(new i.m({channels:[U],source:i.n.EVENT_CHANNEL_READ})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelChanged(U)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})):(this._dispatcher.dispatch(new i.m({channels:[U],source:i.n.EVENT_CHANNEL_READ})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onUnreadMemberStatusUpdated(U)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})),tP.label=12;case 12:return[3,77];case 13:return Z=(A=e.as(eT)).channelUrl,T=void 0===(I=A.deliveredStateUpdate)?{}:I,w=this._groupChannelCache.isCachedInMemory(Z),[4,this.getChannel(Z,!0)];case 14:if(D=tP.sent(),w)for(L in T)D._updateUndeliveredMemberState(L,T[L]);return Object.keys(T).some(function(e){return e!==tF._sdkState.userId})&&(this._dispatcher.dispatch(new i.m({channels:[D],source:i.n.EVENT_CHANNEL_DELIVERED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onUndeliveredMemberStatusUpdated(D)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})),[3,77];case 15:return Z=(k=e.as(o.R)).channelUrl,$=k.channelType,x=k.event,$!==s.K.GROUP?[3,18]:[4,this.getChannel(Z,!0)];case 16:return F=tP.sent(),[4,this.getMessageFromCache(x.messageId)];case 17:(O=tP.sent())&&(O.applyReactionEvent(x),this._dispatcher.dispatch(new s.ae({messages:[O],source:s.ad.EVENT_MESSAGE_REACTION_UPDATED}))),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onReactionUpdated(F,x)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),tP.label=18;case 18:return[3,77];case 19:return(P=e.as(o.T).event).channelType!==s.K.GROUP?[3,22]:[4,this.getChannel(P.channelUrl,!0)];case 20:return R=tP.sent(),[4,this.getMessageFromCache(P.targetMessageId)];case 21:(O=tP.sent())&&(O.applyThreadInfoUpdateEvent(P),this._dispatcher.dispatch(new s.ae({messages:[O],source:s.ad.EVENT_MESSAGE_THREADINFO_UPDATED}))),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onThreadInfoUpdated(R,P)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),tP.label=22;case 22:return[3,77];case 23:V=e.as(o.M).groupChannelMemberCounts,G=[],tP.label=24;case 24:tP.trys.push([24,29,30,31]),q=(H=(0,s.G)(V)).next(),tP.label=25;case 25:return q.done?[3,28]:(Z=(B=q.value).channelUrl,eO=B.memberCount,eV=B.joinedMemberCount,z=B.updatedAt,[4,this.getChannelFromCache(Z)]);case 26:(j=tP.sent())&&j._setLatestMemberCount(eO,eV,z)&&G.push(j),tP.label=27;case 27:return q=H.next(),[3,25];case 28:return[3,31];case 29:return tA={error:tP.sent()},[3,31];case 30:try{q&&!q.done&&(tI=H.return)&&tI.call(H)}finally{if(tA)throw tA.error}return[7];case 31:return G.length>0&&(this._dispatcher.dispatch(new i.m({channels:G,source:i.n.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelMemberCountChanged(G)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})})),[3,77];case 32:return Q=(W=e.as(o.P)).event,K=W.status,Z=W.channelUrl,$=W.channelType,Z&&$?[4,this.getChannel(Z,!0)]:[3,77];case 33:return Y=tP.sent(),this._dispatcher.dispatch(new s.aA({event:Q,source:s.ad.EVENT_POLL_UPDATED})),(0,s.w)(K===s.aE?function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onPollDeleted(Y,Q.pollId)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}:function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onPollUpdated(Y,Q)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),[3,77];case 34:return X=(J=e.as(a.P)).event,Z=J.channelUrl,$=J.channelType,Z&&$?[4,this.getChannel(Z,!0)]:[3,77];case 35:return ee=tP.sent(),this._dispatcher.dispatch(new s.ay({event:X,source:s.ad.EVENT_POLL_VOTED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onPollVoted(ee,X)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),[3,77];case 36:if(!(et=e.as(o.C).event).isGroupChannelEvent)return[3,75];switch(et.category){case o.a.CHANNEL_JOIN:return[3,37];case o.a.CHANNEL_LEAVE:return[3,39];case o.a.CHANNEL_OPERATOR_UPDATE:return[3,43];case o.a.CHANNEL_INVITE:return[3,45];case o.a.CHANNEL_DECLINE_INVITE:return[3,47];case o.a.TYPING_START:case o.a.TYPING_END:return[3,49];case o.a.USER_CHANNEL_MUTE:case o.a.USER_CHANNEL_UNMUTE:return[3,51];case o.a.USER_CHANNEL_BAN:return[3,53];case o.a.USER_CHANNEL_UNBAN:return[3,57];case o.a.CHANNEL_FREEZE:case o.a.CHANNEL_UNFREEZE:return[3,59];case o.a.CHANNEL_HIDE:return[3,61];case o.a.CHANNEL_UNHIDE:return[3,63];case o.a.CHANNEL_DELETED:return[3,65];case o.a.CHANNEL_PROP_CHANGED:return[3,67];case o.a.CHANNEL_META_DATA_CHANGED:return[3,69];case o.a.CHANNEL_META_COUNTERS_CHANGED:return[3,71];case o.a.PINNED_MESSAGE_CHANGED:return[3,73]}return[3,75];case 37:case 40:return[4,this.getChannel(et.channelUrl,!0)];case 38:return en=tP.sent(),es=(er=e.as(ed)).memberCount,ea=er.joinedMemberCount,ei=er.members,eo=!1,ei.forEach(function(e){en.isExclusive||en.isSuper||en.isBroadcast?eo=eo||en._setLatestMemberCount(es,ea,et.ts):(e.state=h.JOINED,en.addMember(e,et.ts),tF._updateJoinedMemberCount(en)),e.userId===tF._sdkState.userId&&(en.myMemberState=h.JOINED)}),this._dispatcher.dispatch(new i.m({channels:[en],source:i.n.EVENT_CHANNEL_JOINED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){var t,n;try{for(var r=(0,s.G)(ei),a=r.next();!a.done;a=r.next()){var i=a.value;e.onUserJoined(en,i)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}en.isBroadcast&&eo&&e.onChannelMemberCountChanged([en])}),[2]})})}),[3,75];case 39:return(eZ=this._leftChannels.get(et.channelUrl))?(ec=eZ.channel,[3,42]):[3,40];case 41:ec=tP.sent(),tP.label=42;case 42:return eu=ec,eO=(el=e.as(e_)).memberCount,eV=el.joinedMemberCount,eh=el.member,ep=!1,ef=s.V.of(this._iid).appInfo,eu.isExclusive||eu.isSuper||eu.isBroadcast?ep=eu._setLatestMemberCount(eO,eV,et.ts):(ef.enabledChannelMemberShipHistory?(eu.members.find(function(e){return e.userId===eh.userId}).state=h.LEFT,eu.memberCount=eO):eu.removeMember(eh),this._updateJoinedMemberCount(eu)),eh.userId===this._sdkState.userId?(eu.myMemberState=h.NONE,eu.invitedAt=0,eu.joinedAt=0,eu._updateUnreadCount(0,0),eu.isPublic?this._dispatcher.dispatch(new i.m({channels:[eu],source:i.n.EVENT_CHANNEL_LEFT})):(this._markAsLeave(eu),this._dispatcher.dispatch(new i.l({channelUrls:[eu.url],source:i.n.EVENT_CHANNEL_LEFT})))):this._dispatcher.dispatch(new i.m({channels:[eu],source:i.n.EVENT_CHANNEL_LEFT})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onUserLeft(eu,eh),eu.isBroadcast&&ep&&e.onChannelMemberCountChanged([eu])}),[2]})})}),[3,75];case 43:case 45:case 47:case 49:case 51:case 54:return[4,this.getChannel(et.channelUrl,!0)];case 44:em=tP.sent(),eb=(eg=e.as(o.O).operators).map(function(e){return e.userId});try{for(eM=(eC=(0,s.G)(em.members)).next();!eM.done;eM=eC.next())(eX=eM.value).role=eb.includes(eX.userId)?s.R.OPERATOR:s.R.NONE}catch(e){tT={error:e}}finally{try{eM&&!eM.done&&(tw=eC.return)&&tw.call(eC)}finally{if(tT)throw tT.error}}return em.myRole=eb.includes(this._sdkState.userId)?s.R.OPERATOR:s.R.NONE,this._dispatcher.dispatch(new i.m({channels:[em],source:i.n.EVENT_CHANNEL_OPERATOR_UPDATED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onOperatorUpdated(em,eg)}),[2]})})}),[3,75];case 46:eN=tP.sent(),eO=(eS=e.as(ev)).memberCount,eV=eS.joinedMemberCount,eU=eS.inviter,(eA=eS.invitees).forEach(function(e){return e.state=h.INVITED});try{for(ew=(eI=(0,s.G)(eA)).next();!ew.done;ew=eI.next())eD=ew.value,eN.isExclusive||eN.isSuper||eN.isBroadcast?eN._setLatestMemberCount(eO,eV,et.ts):eN.addMember(eD,et.ts),this._sdkState.userId===eD.userId&&(eN.hiddenState=tV.UNHIDDEN,eN.myMemberState!==h.JOINED&&(eN.myMemberState=h.INVITED),eN.invitedAt=et.ts)}catch(e){tD={error:e}}finally{try{ew&&!ew.done&&(tL=eI.return)&&tL.call(eI)}finally{if(tD)throw tD.error}}return this._dispatcher.dispatch(new i.m({channels:[eN],source:i.n.EVENT_CHANNEL_INVITED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onUserReceivedInvitation(eN,eU,eA)}),[2]})})}),[3,75];case 48:return ek=tP.sent(),eO=(eF=e.as(ey)).memberCount,eV=eF.joinedMemberCount,eH=eF.inviter,eq=eF.invitee,ek.isExclusive||ek.isSuper||ek.isBroadcast?ek._setLatestMemberCount(eO,eV,et.ts):ek.removeMember(eq),this._sdkState.userId===eq.userId?(ek.invitedAt=0,ek.myMemberState=h.NONE,ek.isPublic?this._dispatcher.dispatch(new i.m({channels:[ek],source:i.n.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new i.l({channelUrls:[ek.url],source:i.n.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new i.m({channels:[ek],source:i.n.EVENT_CHANNEL_DECLINED_INVITE})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onUserDeclinedInvitation(ek,eH,eq)}),[2]})})}),[3,75];case 50:return eB=tP.sent(),ez=et.category===o.a.TYPING_START,ej=e.as(ez?ex:eP).user,eB._updateTypingStatus(ej,ez?et.ts:0),this._dispatcher.dispatch(new i.m({channels:[eB],source:i.n.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onTypingStatusUpdated(eB)}),[2]})})}),[3,75];case 52:eW=tP.sent(),eQ=et.category===o.a.USER_CHANNEL_MUTE,(eK=e.as(eQ?a.w:a.x).user).userId===this._sdkState.userId&&(eW.myMutedState=eQ?tO.MUTED:tO.UNMUTED);try{for(eJ=(eY=(0,s.G)(eW.members)).next();!eJ.done;eJ=eY.next())if((eX=eJ.value).userId===eK.userId){eX.isMuted=eQ;break}}catch(e){tk={error:e}}finally{try{eJ&&!eJ.done&&(tx=eY.return)&&tx.call(eY)}finally{if(tk)throw tk.error}}return this._dispatcher.dispatch(new i.m({channels:[eW],source:eQ?i.n.EVENT_CHANNEL_MUTED:i.n.EVENT_CHANNEL_UNMUTED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){eQ?e.onUserMuted(eW,eK):e.onUserUnmuted(eW,eK)}),[2]})})}),[3,75];case 53:return(eZ=this._leftChannels.get(et.channelUrl))?(e0=eZ.channel,[3,56]):[3,54];case 55:e0=tP.sent(),tP.label=56;case 56:return e$=e0,this._markAsLeave(e$),e1=e.as(a.u).user,(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onUserBanned(e$,e1)}),[2]})})}),[3,75];case 57:case 59:case 61:case 63:case 65:case 69:case 71:case 73:return[4,this.getChannel(et.channelUrl,!0)];case 58:return e2=tP.sent(),e3=e.as(a.t).user,(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onUserUnbanned(e2,e3)}),[2]})})}),[3,75];case 60:return e4=tP.sent(),e7=e.as(a.r).freeze,e4.isFrozen=e7,this._dispatcher.dispatch(new i.m({channels:[e4],source:e7?i.n.EVENT_CHANNEL_FROZEN:i.n.EVENT_CHANNEL_UNFROZEN})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e7?e.onChannelFrozen(e4):e.onChannelUnfrozen(e4)}),[2]})})}),[3,75];case 62:return e5=tP.sent(),e8=(e6=e.as(eL)).allowAutoUnhide,e9=e6.hidePreviousMessages,te=e6.messageOffsetTimestamp,null!==e8&&(e5.hiddenState=e8?tV.HIDDEN_ALLOW_AUTO_UNHIDE:tV.HIDDEN_PREVENT_AUTO_UNHIDE),null!==e9&&e9&&e5._updateUnreadCount(0,0),null!==te&&(e5.messageOffsetTimestamp=te),this._dispatcher.dispatch(new i.m({channels:[e5],source:i.n.EVENT_CHANNEL_HIDDEN})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onChannelHidden(e5)}),[2]})})}),[3,75];case 64:return(tt=tP.sent()).hiddenState=tV.UNHIDDEN,this._dispatcher.dispatch(new i.m({channels:[tt],source:i.n.EVENT_CHANNEL_UNHIDDEN})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onChannelChanged(tt)}),[2]})})}),[3,75];case 66:return tn=tP.sent(),this._dispatcher.dispatch(new i.l({channelUrls:[et.channelUrl],source:i.n.EVENT_CHANNEL_DELETED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onChannelDeleted(tn.url,tn.channelType)}),[2]})})}),[3,75];case 67:return[4,this.getChannelWithoutCache(et.channelUrl,!0)];case 68:return tr=tP.sent(),this._dispatcher.dispatch(new i.m({channels:[tr],source:i.n.EVENT_CHANNEL_UPDATED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onChannelChanged(tr)}),[2]})})}),[3,75];case 70:return ts=tP.sent(),ti=(ta=e.as(a.q)).created,to=ta.updated,tu=ta.deleted,ti&&ts._upsertCachedMetaData(ti,et.ts),to&&ts._upsertCachedMetaData(to,et.ts),tu&&ts._removeFromCachedMetaData(tu,et.ts),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){ti&&e.onMetaDataCreated(ts,ti),to&&e.onMetaDataUpdated(ts,to),tu&&e.onMetaDataDeleted(ts,tu)}),[2]})})}),[3,75];case 72:return tc=tP.sent(),th=(tl=e.as(a.p)).created,td=tl.updated,tp=tl.deleted,(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){th&&e.onMetaCounterCreated(tc,th),td&&e.onMetaCounterUpdated(tc,td),tp&&e.onMetaCounterDeleted(tc,tp)}),[2]})})}),[3,75];case 74:return t_=tP.sent(),tm=(tf=e.as(eG)).pinnedMessageIds,tv=tf.latestPinnedMessage,(tg=tf.ts)>t_._pinnedMessagesUpdatedAt&&(t_.pinnedMessageIds=tm,t_.lastPinnedMessage=tv,t_._pinnedMessagesUpdatedAt=tg,this._dispatcher.dispatch(new i.m({channels:[t_],source:i.n.EVENT_PINNED_MESSAGE_UPDATED})),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){try{for(t=(e=(0,s.G)(this._groupChannelHandlers.values())).next();!t.done;t=e.next())t.value.onChannelChanged(t_)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]})})}),(0,s.w)(function(){return(0,s.b)(tF,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._groupChannelHandlers.forEach(function(e){e.onPinnedMessageUpdated(t_)}),[2]})})})),[3,75];case 75:return[3,77];case 76:switch((ty=e.as(i.U).event).category){case i.e.USER_BLOCK:tC=(tb=i.f.getDataAsUserBlockEvent(this._iid,ty)).blocker,tM=tb.blockee,this._groupChannelCache.block(tC.userId,tM.userId);break;case i.e.USER_UNBLOCK:tC=(tE=i.f.getDataAsUserBlockEvent(this._iid,ty)).blocker,tM=tE.blockee,this._groupChannelCache.unblock(tC.userId,tM.userId)}return[3,77];case 77:return[3,79];case 78:if(tN=tP.sent(),(0,s.ax)(tN))throw tN;return[3,79];case 79:return[2]}})})},e.prototype._markAsLeave=function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout(function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)},1e4)},e.prototype.addHandler=function(e,t){this._groupChannelHandlers.set(e,t)},e.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},e.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},e.prototype.subscribeGroupChannelEvent=function(e,t){this._groupChannelBroadcast.subscribe(e,t)},e.prototype.unsubscribeGroupChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},e.prototype.subscribeMessageEvent=function(e,t){this._messageBroadcast.subscribe(e,t)},e.prototype.unsubscribeMessageEvent=function(e){this._messageBroadcast.unsubscribe(e)},e.prototype._updateJoinedMemberCount=function(e){e.joinedMemberCount=e.members.filter(function(e){return e.state===h.JOINED}).length},e.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),(0,s.b)(this,void 0,void 0,function(){var n;return(0,s.c)(this,function(r){switch(r.label){case 0:(0,s.q)((0,s.a)("string",e)).throw(s.S.invalidParameters),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=r.sent())?[2,n]:[3,4];case 3:return r.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,r.sent()]}})})},e.prototype.getChannelWithoutCache=function(e,t){return void 0===t&&(t=!1),(0,s.b)(this,void 0,void 0,function(){var n,r,a,i;return(0,s.c)(this,function(o){switch(o.label){case 0:return(0,s.q)((0,s.a)("string",e)).throw(s.S.invalidParameters),n=new W({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(n)];case 1:switch(a=(r=o.sent().as(Q).channel).unreadMessageCount,i=r.unreadMentionCount,r.myCountPreference){case tR.UNREAD_MESSAGE_COUNT_ONLY:i=0;break;case tR.UNREAD_MENTION_COUNT_ONLY:a=0;break;case tR.OFF:a=0,i=0}return r._updateUnreadCount(a,i),[4,this.upsertChannelsToCache([r])];case 2:return o.sent(),[2,r]}})})},e.prototype.refreshChannel=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=i.n.REFRESH_CHANNEL),(0,s.b)(this,void 0,void 0,function(){var r,a,o;return(0,s.c)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),r=new W({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(r)];case 1:return(a=u.sent().as(Q).channel).myMemberState===h.NONE?this._dispatcher.dispatch(new i.l({channelUrls:[a.url],source:n})):this._dispatcher.dispatch(new i.m({channels:[a],source:n})),[3,3];case 2:return(o=u.sent()).code!==s.a8.NON_AUTHORIZED&&o.code!==s.a8.NOT_FOUND_IN_DATABASE||this._dispatcher.dispatch(new i.l({channelUrls:[e],source:n})),[3,3];case 3:return[2]}})})},e.prototype.getMyGroupChannels=function(e,t,n,r){return void 0===r&&(r=i.n.REQUEST_CHANNEL),(0,s.b)(this,void 0,void 0,function(){var a,o,u,c;return(0,s.c)(this,function(l){switch(l.label){case 0:return a=new K((0,s.g)((0,s.g)({},t),{userId:this._sdkState.userId,token:e,limit:n})),[4,this._requestQueue.send(a)];case 1:return u=(o=l.sent().as(Y)).channels,c=o.token,this._dispatcher.dispatch(new i.m({channels:u,source:r})),[2,{channels:u,token:c}]}})})},e.prototype.getMessageFromCache=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this._messageCache.get(e)];case 1:return[2,t.sent()]}})})},e.prototype.getMessagesFromCache=function(e,t,n,r,i){return void 0===i&&(i=a.D),(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(s){switch(s.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:i,filter:r,backward:"next"===n})];case 1:return[2,s.sent()]}})})},e.prototype.getPollMessagesFromCache=function(e,t,n,r){return void 0===r&&(r=a.D),(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(s){switch(s.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:r,filter:n,backward:!1,isPollOnly:!0})];case 1:return[2,s.sent()]}})})},e.prototype.getUnsentMessagesFromCache=function(e,t){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(n){switch(n.label){case 0:return[4,this._unsentMessageCache.fetch({channelUrl:e,filter:t})];case 1:return[2,n.sent()]}})})},e.prototype.removeFailedMessageFromCache=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this._unsentMessageCache.remove([e])];case 1:return t.sent(),[2]}})})},e.prototype.getCachedMessageCountBetween=function(e,t,n,r){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(s){switch(s.label){case 0:return[4,this._messageCache.countBetween(e,t,new eV({top:n,bottom:r}))];case 1:return[2,s.sent()]}})})},e.prototype.getMyGroupChannelChangeLogs=function(e,t,n){return void 0===n&&(n=i.n.REQUEST_CHANNEL_CHANGELOGS),(0,s.b)(this,void 0,void 0,function(){var r,a,o,u,c,l;return(0,s.c)(this,function(h){switch(h.label){case 0:return r=(0,s.g)((0,s.g)({},F),t),(0,s.q)(((0,s.a)("string",e)||(0,s.a)("number",e))&&P(r)).throw(s.S.invalidParameters),a=new z((0,s.e)({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,filter:r})),[4,this._requestQueue.send(a)];case 1:return u=(o=h.sent().as(j)).updatedChannels,c=o.deletedChannelUrls,l=o.hasMore,u.length>0&&this._dispatcher.dispatch(new i.m({channels:u,source:n})),c.length>0&&this._dispatcher.dispatch(new i.l({channelUrls:c,source:n})),[2,{updatedChannels:u,deletedChannelUrls:c,hasMore:l,token:o.token}]}})})},e.prototype.getGroupChannelCount=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n;return(0,s.c)(this,function(r){switch(r.label){case 0:return t=(0,s.g)((0,s.g)({},R),e),(0,s.q)(O(t)).throw(s.S.invalidParameters),n=new J({userId:this._sdkState.userId,filter:t}),[4,this._requestQueue.send(n)];case 1:return[2,r.sent().as(X).groupChannelCount]}})})},e.prototype.getUnreadItemCount=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,i,o,u,c,l,h,d,p,_,f,m;return(0,s.c)(this,function(v){switch(v.label){case 0:return t=(0,s.g)((0,s.g)({},V),e),(0,s.q)((0,s.l)(w,t.keys)).throw(s.S.invalidParameters),r=(n=s.V.of(this._iid)).sdkState,a=n.requestQueue,i=new Z({userId:r.userId,filter:t}),[4,a.send(i)];case 1:return u=(o=v.sent().as($)).groupChannelUnreadMentionCount,c=o.groupChannelUnreadMessageCount,l=o.groupChannelInvitationCount,h=o.superGroupChannelUnreadMentionCount,d=o.superGroupChannelUnreadMessageCount,p=o.superGroupChannelInvitationCount,_=o.nonSuperGroupChannelUnreadMentionCount,f=o.nonSuperGroupChannelUnreadMessageCount,m=o.nonSuperGroupChannelInvitationCount,[2,(0,s.e)({groupChannelUnreadMentionCount:u,groupChannelUnreadMessageCount:c,groupChannelInvitationCount:l,superGroupChannelUnreadMentionCount:h,superGroupChannelUnreadMessageCount:d,superGroupChannelInvitationCount:p,nonSuperGroupChannelUnreadMentionCount:_,nonSuperGroupChannelUnreadMessageCount:f,nonSuperGroupChannelInvitationCount:m})]}})})},e.prototype.getTotalUnreadChannelCount=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){switch(a.label){case 0:return t=(e=s.V.of(this._iid)).sdkState,n=e.requestQueue,r=new ee({userId:t.userId}),[4,n.send(r)];case 1:return[2,a.sent().as(et).unreadCount]}})})},e.prototype.getTotalUnreadMessageCount=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,i;return(0,s.c)(this,function(o){switch(o.label){case 0:return t=(0,s.g)((0,s.g)({},G),e),(0,s.q)((0,s.l)("string",t.channelCustomTypesFilter,!0)&&(0,s.H)(_,t.superChannelFilter)).throw(s.S.invalidParameters),r=(n=s.V.of(this._iid)).sdkState,a=n.requestQueue,i=new en({userId:r.userId,filter:t}),[4,a.send(i)];case 1:return[2,o.sent().as(er).unreadCount]}})})},e.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),(0,s.b)(this,void 0,void 0,function(){var t,n,r;return(0,s.c)(this,function(a){switch(a.label){case 0:return t=(0,s.g)((0,s.g)({},H),e),(0,s.q)((0,s.a)("string",t.channelUrl,!0)&&(0,s.l)(u.j,t.scheduledStatus,!0)&&(0,s.H)(s.a2,t.messageTypeFilter)).throw(s.S.invalidParameters),n=s.V.of(this._iid).requestQueue,r=new es(t),[4,n.send(r)];case 1:return[2,a.sent().as(ea).count]}})})},e.prototype.getSubscribedTotalUnreadMessageCount=function(){var e=s.V.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0},e.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){var e=0,t=s.V.of(this._iid).subscribedUnreadMessageCount;for(var n in t.customTypes)e+=t.customTypes[n];return e},e.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){var t;return null!==(t=s.V.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0},e.prototype.createChannel=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r;return(0,s.c)(this,function(a){switch(a.label){case 0:return t=(0,s.g)((0,s.g)({},k),e),(0,s.q)(x(t)).throw(s.S.invalidParameters),t.isPublic||(t.accessCode=null),n=new eo((0,s.g)({userId:this._sdkState.userId},t)),[4,this._requestQueue.send(n)];case 1:return r=a.sent().as(eu).channel,[4,this.upsertChannelsToCache([r])];case 2:return a.sent(),[2,r]}})})},e.prototype.markAsReadAll=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a,i,o,u;return(0,s.c)(this,function(c){switch(c.label){case 0:return e=Date.now(),(0,s.q)(e-this._markAsReadAllLastSentAt>=1e3).throw(s.S.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,t=new ec({userId:this._sdkState.userId}),[4,this._requestQueue.send(t)];case 1:c.sent(),n=this._groupChannelCache.channels;try{for(a=(r=(0,s.G)(n)).next();!a.done;a=r.next())(i=a.value)._updateUnreadMemberState(this._sdkState.userId,e),i._updateUnreadCount(0,0)}catch(e){o={error:e}}finally{try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}}return n.length>0?[4,this.upsertChannelsToCache(n)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}})})},e.prototype.markAsReadWithChannelUrls=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,i,o,u,c,l;return(0,s.c)(this,function(h){switch(h.label){case 0:return t=Date.now(),(0,s.q)((0,s.l)("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(s.S.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new ec({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(n)];case 1:h.sent(),r=this._groupChannelCache.channels,a=[];try{for(o=(i=(0,s.G)(r)).next();!o.done;o=i.next())u=o.value,e.includes(u.url)&&(u._updateUnreadMemberState(this._sdkState.userId,t),u._updateUnreadCount(0,0),a.push(u))}catch(e){c={error:e}}finally{try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}}return a.length>0?[4,this.upsertChannelsToCache(a)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[2]}})})},e.prototype.markAsDelivered=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}})})},e}();(eB=eI||(eI={}))[eB.IDLE=0]="IDLE",eB[eB.RUNNING=1]="RUNNING",eB[eB.END=2]="END";var eB,ez,ej=function(e){function t(t,n,r,s){var a=e.call(this)||this;return a._worker=null,a._state=eI.IDLE,a._semaphore=null,a._retryCount=0,a._retryLimit=3,a.priority=0,a._worker=n,a}return(0,s._)(t,e),Object.defineProperty(t.prototype,"isIdle",{get:function(){return this._state===eI.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{get:function(){return this._state===eI.RUNNING},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDone",{get:function(){return this._state===eI.END},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return this._retryCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"retryLimit",{get:function(){return this._retryLimit},enumerable:!1,configurable:!0}),t.prototype._run=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n;return(0,s.c)(this,function(r){switch(r.label){case 0:if(!this.isRunning)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._worker(e)];case 2:return t=r.sent(),this._retryCount=0,this.dispatch("progress",t),t.hasNext?this._run(t.nextToken):this.end(),[3,4];case 3:return n=r.sent(),this.dispatch("error",n),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop(),[3,4];case 4:return[2]}})})},t.prototype.start=function(e){this.isIdle&&(this._state=eI.RUNNING,this._run(e))},t.prototype.stop=function(){this._state=eI.IDLE,this.dispatch("stop")},t.prototype.end=function(){this._state=eI.END,this.dispatch("end")},t}(s.E),eW=function(e){this.source=e},eQ=function(e){this.source=e},eK={},eY=function(){function e(e){var t,n,r=e._iid,a=e.channel,i=e.limit,o=this;this._prevSync=null,this._nextSync=null,this._connectionEventContext=null,this.ref=0,this._metadata=null,this._iid=r,this._channel=a,this._limit=void 0===i?100:i,this._prevSyncLoopCount=0,this._nextSyncLoopCount=0;var c,l,h=s.V.of(this._iid),d=h.sdkState,p=h.dispatcher,_=h.logger;this._metadataKey=(c=d.userId,l=a.url,"sendbird:".concat(c,"@groupchannel/").concat(l,"/message/sync.meta"));var f=(t=d.userId,n=a.url,"sendbird:".concat(t,"@groupchannel/").concat(n,"/message/sync"));this._prevSync=new ej(f,function(e){return(0,s.b)(o,void 0,void 0,function(){var t,n,r,a,i,o,c;return(0,s.c)(this,function(l){switch(l.label){case 0:return t={hasNext:!0,nextToken:0},this._prevSyncLoopCount++,[4,this.loadMetadata(e)];case 1:if(l.sent(),_.debug("message background prev sync from",null===(o=this._metadata)||void 0===o?void 0:o.range.top),this._metadata.previousComplete)return[3,9];l.label=2;case 2:return l.trys.push([2,5,,8]),[4,u.b.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,(null===(c=this._metadata.range)||void 0===c?void 0:c.top)?this._metadata.range.top:e,{prevResultSize:this._limit,nextResultSize:0,replyType:s.ab.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},s.ad.SYNC_MESSAGE_BACKGROUND)];case 3:return(n=l.sent()).length>0&&(r=n.map(function(e){return e.createdAt}),(i=this._metadata.range).intersect.apply(i,(0,s.o)([],(0,s.p)(r),!1))?this.extendRange(n):this._metadata={range:new eV({top:Math.min.apply(Math,(0,s.o)([],(0,s.p)(r),!1)),bottom:Math.max.apply(Math,(0,s.o)([],(0,s.p)(r),!1))}),previousComplete:!1}),t.hasNext=n.length>=this._limit&&this._prevSyncLoopCount<1,t.nextToken=this._metadata.range.top,this._metadata.previousComplete=n.length<this._limit,_.debug("message background prev sync progress",t),[4,this.saveMetadata()];case 4:return l.sent(),[3,8];case 5:return a=l.sent(),_.debug("message background prev sync error",a),a instanceof s.S&&a.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:l.sent(),l.label=7;case 7:throw a;case 8:return[3,10];case 9:t.hasNext=!1,l.label=10;case 10:return[2,t]}})})}),this._nextSync=new ej(f,function(e){return(0,s.b)(o,void 0,void 0,function(){var t,n,r,a,i,o,c;return(0,s.c)(this,function(l){switch(l.label){case 0:return t={hasNext:!0,nextToken:0},this._nextSyncLoopCount++,[4,this.loadMetadata(e)];case 1:l.sent(),_.debug("message background next sync from",null===(o=this._metadata)||void 0===o?void 0:o.range.bottom),l.label=2;case 2:return l.trys.push([2,5,,6]),[4,u.b.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,(null===(c=this._metadata.range)||void 0===c?void 0:c.bottom)?this._metadata.range.bottom:e,{prevResultSize:0,nextResultSize:this._limit,replyType:s.ab.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},s.ad.SYNC_MESSAGE_BACKGROUND)];case 3:return(n=l.sent()).length>0&&(r=n.map(function(e){return e.createdAt}),(i=this._metadata.range).intersect.apply(i,(0,s.o)([],(0,s.p)(r),!1))?this.extendRange(n):this._metadata={range:new eV({top:Math.min.apply(Math,(0,s.o)([],(0,s.p)(r),!1)),bottom:Math.max.apply(Math,(0,s.o)([],(0,s.p)(r),!1))}),previousComplete:!1}),t.hasNext=n.length>=this._limit&&this._nextSyncLoopCount<1,t.nextToken=this._metadata.range.bottom,_.debug("message background next sync progress",t),[4,this.saveMetadata()];case 4:return l.sent(),[3,6];case 5:throw a=l.sent(),_.debug("message background next sync error",a),a;case 6:return[2,t]}})})}),this._connectionEventContext=p.on(function(e){e instanceof s.s&&(e.stateType===s.t.CONNECTED?o.resume():o.pause())})}return e.of=function(t,n){return eK[t]||(eK[t]={}),eK[t][n.url]||(eK[t][n.url]=new e({_iid:t,channel:n})),eK[t][n.url].ref++,eK[t][n.url]},e.clear=function(e,t){eK[e]&&eK[e][t]&&(eK[e][t].close(),delete eK[e])},Object.defineProperty(e.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousComplete",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)},enumerable:!1,configurable:!0}),e.prototype.isWrappingMessages=function(e){var t;return null===(t=this.range)||void 0===t?void 0:t.includes.apply(t,(0,s.o)([],(0,s.p)(e.map(function(e){return e.createdAt})),!1))},e.prototype.extendRange=function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,(0,s.o)([],(0,s.p)(e.map(function(e){return e.createdAt})),!1))},e.prototype.loadMetadata=function(e){return(0,s.b)(this,void 0,void 0,function(){var t;return(0,s.c)(this,function(n){switch(n.label){case 0:return this._metadata?[3,2]:[4,s.V.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:(t=n.sent())?t.range.bottom<e?this._metadata={range:new eV({}),previousComplete:!1}:this._metadata=(0,s.g)({},t):this._metadata={range:new eV({}),previousComplete:!1},n.label=2;case 2:return[2,this._metadata]}})})},e.prototype.saveMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return this._metadata?[4,s.V.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}})})},e.prototype.clearMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,s.V.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}})})},e.prototype.resume=function(e){void 0===e&&(e=Date.now());var t,n,r,a,i=s.V.of(this._iid),o=i.logger;i.connectionManager.isConnected&&(o.debug("message background sync resume()"),this._prevSyncLoopCount=this._nextSyncLoopCount=0,this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(n=null===(t=this._metadata)||void 0===t?void 0:t.range.top)&&void 0!==n?n:e),this._nextSync.start(null!==(a=null===(r=this._metadata)||void 0===r?void 0:r.range.bottom)&&void 0!==a?a:e))},e.prototype.pause=function(){s.V.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete eK[this._iid][this._channel.url])},e}(),eJ={},eX=function(){function e(e){var t,n,r=e._iid,a=e.channel,i=this;this._sync=null,this._connectionEventContext=null,this.ref=0,this._metadata=null,this._iid=r,this._channel=a;var o,c,l=s.V.of(this._iid),h=l.logger,d=l.sdkState,p=l.dispatcher;this._metadataKey=(o=d.userId,c=a.url,"sendbird:".concat(o,"@groupchannel/").concat(c,"/message/changelogs.meta"));var _=(t=d.userId,n=this._channel.url,"sendbird:".concat(t,"@groupchannel/").concat(n,"/message/changelogs"));this._sync=new ej(_,function(){return(0,s.b)(i,void 0,void 0,function(){var e,t,n,r,a,i,o,c;return(0,s.c)(this,function(l){switch(l.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:l.sent(),h.debug("message changelog sync from",null===(c=this._metadata)||void 0===c?void 0:c.token),l.label=2;case 2:return l.trys.push([2,5,,8]),[4,u.b.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{replyType:s.ab.ALL,includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0},s.ad.SYNC_MESSAGE_CHANGELOGS)];case 3:return n=(t=l.sent()).updatedMessages,r=t.deletedMessageIds,a=t.hasMore,i=t.token,e.hasNext=a,e.nextToken=i,(n.length>0||r.length>0)&&(this._metadata.token=i),h.debug("message changelog sync progress",e),[4,this.saveMetadata()];case 4:return l.sent(),[3,8];case 5:return o=l.sent(),h.debug("message changelog sync error",o),o instanceof s.S&&o.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:l.sent(),l.label=7;case 7:throw o;case 8:return[2,e]}})})}),this._connectionEventContext=p.on(function(e){e instanceof s.s&&(e.stateType===s.t.CONNECTED?i.resume():i.pause())})}return e.of=function(t,n){return eJ[t]||(eJ[t]={}),eJ[t][n.url]||(eJ[t][n.url]=new e({_iid:t,channel:n})),eJ[t][n.url].ref++,eJ[t][n.url]},e.clear=function(e,t){eJ[e]&&eJ[e][t]&&(eJ[e][t].close(),delete eJ[e])},e.prototype.loadMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){switch(a.label){case 0:return this._metadata?[3,2]:(t=(e=s.V.of(this._iid)).cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=a.sent(),this._metadata={token:r?r.token:n},a.label=2;case 2:return[2,this._metadata]}})})},e.prototype.saveMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return this._metadata?[4,s.V.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}})})},e.prototype.clearMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,s.V.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}})})},e.prototype.resume=function(){var e=s.V.of(this._iid),t=e.logger;e.connectionManager.isConnected&&(t.debug("message changelog sync resume()"),this._sync.start(0))},e.prototype.pause=function(){var e=s.V.of(this._iid),t=e.logger;e.connectionManager.isConnected&&(t.debug("message changelog sync pause()"),this._sync.stop())},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete eJ[this._iid][this._channel.url])},e}(),eZ=function(e){function t(t){var n,r,a,i,o,u,c=this;return(c=e.call(this)||this).method=s.A.GET,c.path="".concat((0,s.a6)(t.channelType),"/").concat(t.channelUrl,"/messages_gap"),c.params=(0,s.e)({prev_start_ts:t.prevStart,prev_end_ts:t.prevEnd,prev_cache_count:t.prevCount,next_start_ts:t.nextStart,next_end_ts:t.nextEnd,next_cache_count:t.nextCount,huge_gap_threshold:null!==(n=t.threshold)&&void 0!==n?n:null,reverse:!0,custom_types:null!==(r=t.customTypes)&&void 0!==r?r:["*"],message_type:null!==(a=t.messageType)&&void 0!==a?a:null,include_reactions:null===(i=t.includeReactions)||void 0===i||i,with_sorted_meta_array:null===(o=t.includeMetaArray)||void 0===o||o,show_subchannel_messages_only:null!==(u=t.showSubchannelMessagesOnly)&&void 0!==u&&u,include_poll_details:!0,checking_continuous_messages:t.checkingContinuousMessages}),c}return(0,s._)(t,e),t}(s.f),e$=function(e){function t(t,n){var r,s,a,i,o,c,l=this;return(l=e.call(this,t,n)||this).isHugeGap=n.is_huge_gap,l.prevMessages=(null!==(r=n.prev_messages)&&void 0!==r?r:[]).map(function(e){return(0,u.p)(t,e)}),l.prevHasMore=null!==(s=n.prev_hasmore)&&void 0!==s&&s,l.isContinuousPrevMessages=null!==(a=n.is_continuous_prev_messages)&&void 0!==a&&a,l.nextMessages=(null!==(i=n.next_messages)&&void 0!==i?i:[]).map(function(e){return(0,u.p)(t,e)}),l.nextHasmore=null!==(o=n.next_hasmore)&&void 0!==o&&o,l.isContinuousNextMessages=null!==(c=n.is_continuous_next_messages)&&void 0!==c&&c,l}return(0,s._)(t,e),t}(s.h),e0=function(e,t){return e.findIndex(function(e){return e.isIdentical(t)})},e1=function(e,t,n){if(e.length>0){var r=e0(e,t);if(r<0){for(var s=0,a=e.length-1,i=Math.floor((s+a)/2);s<a;){var o=e2(e[i],t,n);if(o>0)i=Math.floor((s+(a=i))/2);else{if(!(o<0))return{place:i,contains:e[i].isIdentical(t)};i=Math.floor(((s=i+1)+a)/2)}}return{place:e2(e[i],t,n)>0?i:i+1,contains:!1}}return{place:r,contains:!0}}return{place:e.length,contains:!1}},e2=function(e,t,n){switch(n){case i.G.LATEST_LAST_MESSAGE:return e.lastMessage&&t.lastMessage?t.lastMessage.createdAt-e.lastMessage.createdAt:e.lastMessage?-1:t.lastMessage?1:t.createdAt-e.createdAt;case i.G.CHRONOLOGICAL:return t.createdAt-e.createdAt;case i.G.CHANNEL_NAME_ALPHABETICAL:return e.name.localeCompare(t.name)}},e3=function(e,t){return t instanceof u.S?e.findIndex(function(e){return e instanceof u.S&&t.isIdentical(e)}):e.findIndex(function(e){return e.isIdentical(t)})},e4=function(e,t){return e.findIndex(function(e){return e.messageId===t})},e7=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,s=Math.floor((n+r)/2);n<r;){var a=e[s].createdAt-t.createdAt;if(a>0)s=Math.floor((n+(r=s))/2);else{if(!(a<0))return s;s=Math.floor(((n=s+1)+r)/2)}}return e[s].createdAt>t.createdAt?s:s+1}return e.length},e5={},e6=function(){function e(e){var t,n,r=e._iid,a=e.channel,i=e.hasPollMessage,o=this;this._sync=null,this.ref=0,this._metadata=null,this._iid=r,this._channel=a;var u,l,h=s.V.of(this._iid),d=h.logger,p=h.sdkState,_=h.dispatcher;this._metadataKey=(u=p.userId,l=a.url,"sendbird:".concat(u,"@groupchannel/").concat(l,"/poll/changelogs.meta"));var f=(t=p.userId,n=this._channel.url,"sendbird:".concat(t,"@groupchannel/").concat(n,"/poll/changelogs"));this._sync=new ej(f,function(){return(0,s.b)(o,void 0,void 0,function(){var e,t,n,r,a,o,u,l;return(0,s.c)(this,function(h){switch(h.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return h.sent(),d.debug("poll changelog sync from",null===(l=this._metadata)||void 0===l?void 0:l.token),(t=!this._metadata||!this._metadata.token)?[4,i()]:[3,3];case 2:t=!h.sent(),h.label=3;case 3:if(t)return[2,{hasNext:!1,nextToken:0}];this._metadata||(n=s.V.of(this._iid).firstConnectedAt,this._metadata={token:n}),h.label=4;case 4:return h.trys.push([4,7,,10]),[4,c.b.of(this._iid).getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token)];case 5:return a=(r=h.sent()).hasMore,o=r.token,e.hasNext=a,e.nextToken=o,this._metadata.token=o,d.debug("poll changelog sync progress",e),[4,this.saveMetadata()];case 6:return h.sent(),[3,10];case 7:return u=h.sent(),d.debug("poll changelog sync error",u),u instanceof s.S&&u.isInvalidTokenError?[4,this.clearMetadata()]:[3,9];case 8:h.sent(),h.label=9;case 9:throw u;case 10:return[2,e]}})})}),this._connectionEventContext=_.on(function(e){e instanceof s.s&&(e.stateType===s.t.CONNECTED?o.resume():o.pause())})}return e.of=function(t,n,r){return e5[t]||(e5[t]={}),e5[t][n.url]||(e5[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:r})),e5[t][n.url].ref++,e5[t][n.url]},e.prototype.loadMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){var e;return(0,s.c)(this,function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,s.V.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata=e?{token:e.token}:null,t.label=2;case 2:return[2]}})})},e.prototype.saveMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return this._metadata?[4,s.V.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.clearMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,s.V.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}})})},e.prototype.resume=function(){s.V.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)},e.prototype.pause=function(){s.V.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete e5[this._iid][this._channel.url])},e}();(ez||(ez={})).CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api";var e8,e9,te,tt=function(){function e(){}return e.prototype._invokeResponse=function(e,t,n){var r=this;(0,s.w)(function(){return(0,s.b)(r,void 0,void 0,function(){return(0,s.c)(this,function(r){switch(e){case"local":this._onCacheResult(t,n);break;case"remote":this._onApiResult(t,n)}return[2]})})})},e.prototype.onCacheResult=function(e){return this._onCacheResult=e,this},e.prototype.onApiResult=function(e){return this._onApiResult=e,this},e}(),tn=function(){function e(e,t){var n=t.channel,r=t.filter,o=t.startingPoint,u=t.limit,c=this;this._channel=null,this._messages=[],this._unsentMessages=[],this._backgroundSync=null,this._changelogSync=null,this._pollChangelogSync=null,this._iid=e,this._key="mc-".concat((0,s.u)()),this.filter=null!=r?r:new i.p,this._channel=n,this._syncRange=new eV({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint="number"==typeof o?o:Date.now()+6e5,this._limit=u||a.D;var l=eq.of(this._iid);l.subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n=e0(e,c._channel);if(n>=0&&((0,s.w)(function(){return(0,s.b)(c,void 0,void 0,function(){var r,a;return(0,s.c)(this,function(s){return r=new eW(t),this._channel=e[n],(0,i.s)(t)&&(null===(a=this._handler)||void 0===a?void 0:a.onChannelUpdated)&&this._handler.onChannelUpdated(r,this.channel),[2]})})}),t===i.n.EVENT_CHANNEL_UPDATED)){var r=!1;for(var a in c._messages)if(c._messages[a].createdAt>=c._channel.messageOffsetTimestamp){r=!0;var o=parseInt(a);if(o>0){var u=c._messages.splice(0,o);c._removeMessagesFromView(u.map(function(e){return e.messageId}),s.ad.EVENT_MESSAGE_OFFSET_UPDATED)}break}!r&&c._messages.length>0&&c._removeMessagesFromView(c._messages.map(function(e){return e.messageId}),s.ad.EVENT_MESSAGE_OFFSET_UPDATED)}},onRemove:function(e,t){e.indexOf(c.channel.url)>=0&&(0,s.w)(function(){return(0,s.b)(c,void 0,void 0,function(){var e,n;return(0,s.c)(this,function(r){return e=new eW(t),(null===(n=this._handler)||void 0===n?void 0:n.onChannelDeleted)&&this._handler.onChannelDeleted(e,this.channel.url),[2]})})})}}),l.subscribeMessageEvent(this._key,{onUpdate:function(e,t){var n,r,a=[],i=[];try{for(var o=(0,s.G)(e),u=o.next();!u.done;u=o.next()){var l=u.value;l.channelUrl===c._channel.url&&(c.filter.match(l)?a.push(l):i.push(l.messageId))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}if((0,s.aF)(t)){if(a.length>0)switch(t){case s.ad.EVENT_MESSAGE_SENT_FAILED:case s.ad.EVENT_MESSAGE_SENT_SUCCESS:case s.ad.EVENT_MESSAGE_UPDATED:case s.ad.EVENT_MESSAGE_THREADINFO_UPDATED:case s.ad.EVENT_MESSAGE_REACTION_UPDATED:case s.ad.SYNC_MESSAGE_CHANGELOGS:c._updateMessagesToView(a,t);break;case s.ad.EVENT_MESSAGE_SENT_PENDING:c._addMessagesToView(a,t);break;case s.ad.EVENT_MESSAGE_RECEIVED:c.hasNext||c._addMessagesToView(a,t);break;case s.ad.SYNC_MESSAGE_FILL:c._addMessagesToView(a,t)}i.length>0&&c._removeMessagesFromView(i,t)}},onRemove:function(e,t){c._removeMessagesFromView(e,t)},onRemoveUnsent:function(e,t){c._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){c._updatePollsToView(e,t)},onPollUpdate:function(e,t){c._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){c._applyPollVoteEventToView(e,t)}});var h=s.V.of(this._iid),d=h.cacheContext,p=h.dispatcher,_=h.logger;this._channel._updateMessageCollectionLastAccessedAt(),p.dispatch(new i.m({channels:[this._channel],source:i.n.CHANNEL_LASTACCESSEDAT_UPDATED})),!this._channel.isSuper&&d.localCacheEnabled&&(this._backgroundSync=eY.of(this._iid,this._channel),this._backgroundSync.resume(this._startingPoint)),this._changelogSync=eX.of(this._iid,this._channel),this._changelogSync.resume(),this._pollChangelogSync=e6.of(this._iid,this._channel,this._hasPollMessage.bind(this)),this._pollChangelogSync.resume(),this._prevFill=new ej(this._key,function(e){return(0,s.b)(c,void 0,void 0,function(){var t,n,r,a,i;return(0,s.c)(this,function(o){switch(o.label){case 0:return[4,this._getRemoteMessages(e,{prevLimit:this._limit,source:s.ad.SYNC_MESSAGE_FILL,checkingContinuousMessages:d.localCacheEnabled})];case 1:return n=(t=o.sent()).messages,r=t.isContinuousMessages,n.length>0?(a=Math.min.apply(Math,(0,s.o)([],(0,s.p)(n.map(function(e){return e.createdAt})),!1)),this._syncRange.extends(a),r&&(null===(i=this._backgroundSync)||void 0===i||i.range.extends(a)),[2,{hasNext:n.length>=this._limit&&this.viewTop<a,nextToken:this._syncRange.top}]):[2,{hasNext:!1,nextToken:0}]}})})}),this._nextFill=new ej(this._key,function(e){return(0,s.b)(c,void 0,void 0,function(){var t,n,r,a,i;return(0,s.c)(this,function(o){switch(o.label){case 0:return[4,this._getRemoteMessages(e,{nextLimit:this._limit,source:s.ad.SYNC_MESSAGE_FILL,checkingContinuousMessages:d.localCacheEnabled})];case 1:return n=(t=o.sent()).messages,r=t.isContinuousMessages,n.length>0?(a=Math.max.apply(Math,(0,s.o)([],(0,s.p)(n.map(function(e){return e.createdAt})),!1)),this._syncRange.extends(a),r&&(null===(i=this._backgroundSync)||void 0===i||i.range.extends(a)),[2,{hasNext:!(n.length>=this._limit&&this._hasNext)||this.viewBottom>a,nextToken:this._syncRange.bottom}]):[2,{hasNext:!1,nextToken:0}]}})})}),this._connectionEventContext=p.on(function(e){e instanceof s.s&&(e.stateType===s.t.CONNECTED?(c._refreshChannel(i.n.SYNC_CHANNEL_CHANGELOGS),_.debug("check huge gap"),c._checkHugeGap()):(c._prevFill.stop(),c._nextFill.stop()))})}return Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"succeededMessages",{get:function(){return(0,s.o)([],(0,s.p)(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter(function(e){return e.sendingStatus===s.a0.FAILED})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter(function(e){return e.sendingStatus===s.a0.PENDING})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewTop",{get:function(){return Math.min.apply(Math,(0,s.o)((0,s.o)([],(0,s.p)(this._messages.map(function(e){return e.createdAt})),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,(0,s.o)((0,s.o)([],(0,s.p)(this._messages.map(function(e){return e.createdAt})),!1),[0],!1))},enumerable:!1,configurable:!0}),e.prototype.setMessageCollectionHandler=function(e){this._handler=e},e.prototype._filterUnderOffsetMessage=function(e){return e},e.prototype._addMessagesToView=function(e,t){var n,r,a=this,i=this._filterUnderOffsetMessage(e),o=[],c=[];try{for(var l=(0,s.G)(i),h=l.next();!h.done;h=l.next()){var d,p=h.value;if(t===s.ad.SYNC_MESSAGE_FILL){if(p.messageId>0){if((d=e3(this._messages,p))<0){0>e3(this._unsentMessages,p)&&o.push(p);var _=e7(this._messages,p);this._messages.splice(_,0,p)}}else p instanceof u.S&&(d=e3(this._unsentMessages,p))<0&&0>e3(this._messages,p)&&(this._unsentMessages.push(p),o.push(p))}else if(p.messageId>0){if((d=e3(this._messages,p))<0){var f=e3(this._unsentMessages,p);f<0?o.push(p):(this._unsentMessages.splice(f,1),c.push(p)),_=e7(this._messages,p),this._messages.splice(_,0,p)}else c.push(p),this._messages[d]=p;if(p.updatedAt>0){var m=this._updateChildMessagesInView(p);c.push.apply(c,(0,s.o)([],(0,s.p)(m),!1))}}else p instanceof u.S&&((d=e3(this._unsentMessages,p))<0?0>e3(this._messages,p)&&(this._unsentMessages.push(p),o.push(p)):(c.push(p),this._unsentMessages[d]=p))}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}(0,s.aF)(t)&&(0,s.w)(function(){return(0,s.b)(a,void 0,void 0,function(){var e,n,r;return(0,s.c)(this,function(s){return e=new eQ(t),o.length>0&&(null===(n=this._handler)||void 0===n||n.onMessagesAdded(e,this.channel,o)),c.length>0&&(null===(r=this._handler)||void 0===r||r.onMessagesUpdated(e,this.channel,c)),[2]})})})},e.prototype._updateChildMessagesInView=function(e){var t=[];return this._messages.forEach(function(n){n.applyParentMessage(e)&&t.push(n)}),t},e.prototype._updatePollsToView=function(e,t){var n,r,a=this,i=[];try{for(var o=(0,s.G)(e),u=o.next();!u.done;u=o.next()){var c=u.value,l=e4(this._messages,c.messageId);if(l>=0){var h=this._messages[l];h&&h.applyPoll(c),i.push(h)}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i.length>0&&(0,s.aF)(t)&&(0,s.w)(function(){return(0,s.b)(a,void 0,void 0,function(){var e,n;return(0,s.c)(this,function(r){return e=new eQ(t),i.length>0&&(null===(n=this._handler)||void 0===n||n.onMessagesUpdated(e,this.channel,i)),[2]})})}),i},e.prototype._applyPollUpdateEventToView=function(e,t){var n=this,r=e4(this._messages,e.messageId);if(r>=0){var a=this._messages[r];a&&a.isUserMessage()&&a.poll&&a.poll.applyPollUpdateEvent(e)&&(0,s.aF)(t)&&(0,s.w)(function(){return(0,s.b)(n,void 0,void 0,function(){var e,n;return(0,s.c)(this,function(r){return e=new eQ(t),null===(n=this._handler)||void 0===n||n.onMessagesUpdated(e,this.channel,[a]),[2]})})})}},e.prototype._applyPollVoteEventToView=function(e,t){var n=this,r=e4(this._messages,e.messageId);if(r>=0){var a=this._messages[r];a&&a.isUserMessage()&&a.poll&&a.poll.applyPollVoteEvent(e)&&(0,s.aF)(t)&&(0,s.w)(function(){return(0,s.b)(n,void 0,void 0,function(){var e,n;return(0,s.c)(this,function(r){return e=new eQ(t),null===(n=this._handler)||void 0===n||n.onMessagesUpdated(e,this.channel,[a]),[2]})})})}},e.prototype._updateMessagesToView=function(e,t){var n,r,a=this,i=[],o=[];try{for(var c=(0,s.G)(e),l=c.next();!l.done;l=c.next()){var h,d=l.value;if(d.messageId>0){if((h=e3(this._messages,d))>=0)i.push(d),this._messages[h]=d;else{var p=e3(this._unsentMessages,d);if(p>=0){var _=this._unsentMessages.splice(p,1);if(this.hasNext&&_.length>0)o.push(_[0]);else{i.push(d);var f=e7(this._messages,d);this._messages.splice(f,0,d)}}}}else d instanceof u.S&&(h=e3(this._unsentMessages,d))>=0&&(i.push(d),this._unsentMessages[h]=d)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return(0,s.aF)(t)&&(0,s.w)(function(){return(0,s.b)(a,void 0,void 0,function(){var e,n,r;return(0,s.c)(this,function(s){return e=new eQ(t),i.length>0?null===(n=this._handler)||void 0===n||n.onMessagesUpdated(e,this.channel,i):o.length>0&&(null===(r=this._handler)||void 0===r||r.onMessagesDeleted(e,this.channel,[],o)),[2]})})}),i},e.prototype._removeMessagesFromView=function(e,t){var n,r,a=this,i=[],o=[],u=function(e){var t=c._messages.findIndex(function(t){return t.messageId===e});if(t>=0){var n=c._messages[t];i.push(n.messageId),o.push(n),c._messages.splice(t,1)}},c=this;try{for(var l=(0,s.G)(e),h=l.next();!h.done;h=l.next())u(h.value)}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return(0,s.aF)(t)&&o.length>0&&(0,s.w)(function(){return(0,s.b)(a,void 0,void 0,function(){var e,n;return(0,s.c)(this,function(r){return e=new eQ(t),null===(n=this._handler)||void 0===n||n.onMessagesDeleted(e,this.channel,i,o),[2]})})}),i},e.prototype._removeUnsentMessageFromView=function(e,t){var n=this._unsentMessages.findIndex(function(t){return t.reqId===e});n>=0&&this._unsentMessages.splice(n,1)},e.prototype._getLocalMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,a=t.nextLimit,i=void 0===a?0:a;return(0,s.b)(this,void 0,void 0,function(){var t,n,a,o,u,c,l;return(0,s.c)(this,function(h){switch(h.label){case 0:return t=eq.of(this._iid),r>0?[4,t.getMessagesFromCache(this._channel.url,e,"prev",this.filter,r)]:[3,2];case 1:return a=h.sent(),[3,3];case 2:a=[],h.label=3;case 3:return n=a,i>0?[4,t.getMessagesFromCache(this._channel.url,e,"next",this.filter,i)]:[3,5];case 4:return u=h.sent(),[3,6];case 5:u=[],h.label=6;case 6:if(o=u,n.length>0&&o.length>0){for(l in c=n.map(function(e){return e.messageId}),o)if(c.includes(o[l].messageId)){o.splice(parseInt(l),1);break}}return[2,(0,s.o)((0,s.o)([],(0,s.p)(n),!1),(0,s.p)(o),!1).sort(function(e,t){return t.createdAt-e.createdAt})]}})})},e.prototype._getRemoteMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,a=t.nextLimit,i=void 0===a?0:a,o=t.source,c=void 0===o?s.ad.REQUEST_MESSAGE:o,l=t.reverse,h=void 0!==l&&l,d=t.checkingContinuousMessages,p=void 0!==d&&d;return(0,s.b)(this,void 0,void 0,function(){var t,n;return(0,s.c)(this,function(a){switch(a.label){case 0:return t=u.b.of(this._iid),r>0||i>0?[4,t._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,e,(0,s.g)((0,s.g)({},this.filter),{isInclusive:!0,reverse:h,prevResultSize:r,nextResultSize:i,includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0}),c,p)]:[3,2];case 1:return n=a.sent(),[3,3];case 2:n={messages:[],isContinuousMessages:!1},a.label=3;case 3:return[2,n]}})})},e.prototype._checkHugeGap=function(){var e;return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,i,o,u,c,l,h,d,p,_,f,m,v,g,y,b,E=this;return(0,s.c)(this,function(C){switch(C.label){case 0:return this._messages.length>0?(t=this._syncRange.top,n=this.viewTop,r=this._syncRange.bottom,a=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,[4,(i=eq.of(this._iid)).getCachedMessageCountBetween(this._channel.url,this.filter,n,t)]):[3,4];case 1:return o=C.sent(),[4,i.getCachedMessageCountBetween(this._channel.url,this.filter,r,a)];case 2:return u=C.sent(),[4,(0,s.aG)(function(){return(0,s.b)(E,void 0,void 0,function(){var e,i,c,l,h,d,p,_,f,m,v,g,y,b,E,C,M,N,S,U,A=this;return(0,s.c)(this,function(I){switch(I.label){case 0:return i=(e=s.V.of(this._iid)).dispatcher,c=e.requestQueue,l=e.cacheContext,h=new eZ((0,s.g)({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:n,prevEnd:t,prevCount:o,nextStart:r,nextEnd:a,nextCount:u,checkingContinuousMessages:l.localCacheEnabled},this.filter)),[4,c.send(h)];case 1:return p=(d=I.sent().as(e$)).isHugeGap,f=void 0===(_=d.prevMessages)?[]:_,m=d.prevHasMore,v=d.isContinuousPrevMessages,y=void 0===(g=d.nextMessages)?[]:g,b=d.nextHasmore,E=d.isContinuousNextMessages,p?(0,s.w)(function(){return(0,s.b)(A,void 0,void 0,function(){var e;return(0,s.c)(this,function(t){return null===(e=this._handler)||void 0===e||e.onHugeGapDetected(),[2]})})}):(this._hasPrevious=m,this._hasNext=b,C=this.viewTop,M=this.viewBottom,N=Math.min.apply(Math,(0,s.o)([Number.MAX_SAFE_INTEGER,C],(0,s.p)(f.map(function(e){return e.createdAt})),!1)),S=Math.max.apply(Math,(0,s.o)([0,M],(0,s.p)(y.map(function(e){return e.createdAt})),!1)),i.dispatch(new s.ae({messages:f,source:s.ad.SYNC_MESSAGE_FILL})),i.dispatch(new s.ae({messages:y,source:s.ad.SYNC_MESSAGE_FILL})),this._syncRange.extends(N,S),(v||E)&&(null===(U=this._backgroundSync)||void 0===U||U.range.extends(N,S)),C<N&&this._prevFill.start(N),M>S&&this._nextFill.start(S)),[2]}})})},1)];case 3:return C.sent(),[3,6];case 4:return c=s.V.of(this._iid).cacheContext,l=Math.floor(this._limit/2),h=Date.now(),[4,this._getRemoteMessages(h,{prevLimit:l,nextLimit:l,source:s.ad.SYNC_MESSAGE_FILL,checkingContinuousMessages:c.localCacheEnabled})];case 5:if(p=(d=C.sent()).messages,_=d.isContinuousMessages,p.length>0){for(f=p.map(function(e){return e.createdAt}),m=0,v=0,g=0;g<f.length;g++)(y=f[g])<=h?m++:y>=h&&v++;this._hasPrevious=m>=l,this._hasNext=v>=l,(b=this._syncRange).extends.apply(b,(0,s.o)([],(0,s.p)(p.map(function(e){return e.createdAt})),!1)),_&&(null===(e=this._backgroundSync)||void 0===e||e.range.extends(this._syncRange.top,this._syncRange.bottom)),this._addMessagesToView(p,s.ad.SYNC_MESSAGE_FILL)}else this._hasPrevious=!1,this._hasNext=!1;C.label=6;case 6:return[2]}})})},e.prototype._loadUnsentMessages=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t;return(0,s.c)(this,function(n){switch(n.label){case 0:return e=eq.of(this._iid),t=this,[4,e.getUnsentMessagesFromCache(this._channel.url,this.filter)];case 1:return t._unsentMessages=n.sent(),[2]}})})},e.prototype._hasPollMessage=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,eq.of(this._iid).getPollMessagesFromCache(this._channel.url,Date.now()+6e5,this.filter,1)];case 1:return e.sent().length>0?[2,!0]:[2,!1]}})})},e.prototype._refreshChannel=function(e){eq.of(this._iid).refreshChannel(this.channel.url,!0,e)},e.prototype.initialize=function(e){var t=this,n=new tt;this._messages=[],this._unsentMessages=[],this._syncRange=new eV({}),this._hasNext=!0,this._hasPrevious=!0,this._refreshChannel(i.n.REFRESH_CHANNEL);var r=Math.floor(this._limit/2);return e===ez.CACHE_AND_REPLACE_BY_API&&this._getLocalMessages(this._startingPoint,{prevLimit:r,nextLimit:r}).then(function(e){return(0,s.b)(t,void 0,void 0,function(){var t;return(0,s.c)(this,function(r){switch(r.label){case 0:return t=this._filterUnderOffsetMessage(e),this._addMessagesToView(t,s.ad.REQUEST_MESSAGE),[4,this._loadUnsentMessages()];case 1:return r.sent(),n._invokeResponse("local",null,t),[2]}})})}).catch(function(e){if((0,s.ax)(e))throw e;n._invokeResponse("local",e,null)}).finally(function(){var e=s.V.of(t._iid).cacheContext;t._getRemoteMessages(t._startingPoint,{prevLimit:r,nextLimit:r,reverse:!0,checkingContinuousMessages:e.localCacheEnabled}).then(function(e){var a,i,o=e.messages,u=e.isContinuousMessages;t._messages=[];var c=t._filterUnderOffsetMessage(o);if(c.length>0){for(var l=c.map(function(e){return e.createdAt}),h=0,d=0,p=0;p<l.length;p++){var _=l[p];_<=t._startingPoint?h++:_>=t._startingPoint&&d++}t._hasPrevious=h>=r,t._hasNext=d>=r,(a=t._syncRange).extends.apply(a,(0,s.o)([],(0,s.p)(c.map(function(e){return e.createdAt})),!1)),u&&(null===(i=t._backgroundSync)||void 0===i||i.range.extends(t._syncRange.top,t._syncRange.bottom)),t._addMessagesToView(c,s.ad.REQUEST_MESSAGE)}else t._hasPrevious=!1,t._hasNext=!1;n._invokeResponse("remote",null,c)}).catch(function(e){if((0,s.ax)(e))throw e;n._invokeResponse("remote",e,null)})}),n},e.prototype.loadPrevious=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r=this;return(0,s.c)(this,function(a){switch(a.label){case 0:return this._hasPrevious?(e=this.viewTop,t=[],[4,(0,s.F)(function(){return(0,s.b)(r,void 0,void 0,function(){var n;return(0,s.c)(this,function(r){switch(r.label){case 0:return n=this._filterUnderOffsetMessage,[4,this._getLocalMessages(e,{prevLimit:this._limit})];case 1:return t=n.apply(this,[r.sent()]),[2]}})})})]):[3,5];case 1:return a.sent(),0!==t.length&&this._backgroundSync&&this._backgroundSync.isWrappingMessages(t)?[3,3]:[4,(0,s.F)(function(){return(0,s.b)(r,void 0,void 0,function(){var n,r,a,i,o;return(0,s.c)(this,function(u){switch(u.label){case 0:return n=s.V.of(this._iid).cacheContext,[4,this._getRemoteMessages(e,{prevLimit:this._limit,checkingContinuousMessages:n.localCacheEnabled})];case 1:return r=u.sent(),t=this._filterUnderOffsetMessage(r.messages),this._hasPrevious=t.length>=this._limit,t.length>0&&((a=this._syncRange).extends.apply(a,(0,s.o)([],(0,s.p)(t.map(function(e){return e.createdAt})),!1)),(null===(i=this._backgroundSync)||void 0===i?void 0:i.range.overlap(this._syncRange))&&r.isContinuousMessages&&(null===(o=this._backgroundSync)||void 0===o||o.range.extends(this._syncRange.top))),[2]}})})})];case 2:return a.sent(),this._addMessagesToView(t,s.ad.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=t.length>=this._limit,t.length>0&&((n=this._syncRange).extends.apply(n,(0,s.o)([],(0,s.p)(t.map(function(e){return e.createdAt})),!1)),this._addMessagesToView(t,s.ad.REQUEST_MESSAGE)),a.label=4;case 4:return[2,t];case 5:return[2,[]]}})})},e.prototype.loadNext=function(){var e;return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a=this;return(0,s.c)(this,function(i){switch(i.label){case 0:return this._hasNext?(t=this.viewBottom,n=[],[4,(0,s.F)(function(){return(0,s.b)(a,void 0,void 0,function(){var e;return(0,s.c)(this,function(r){switch(r.label){case 0:return e=this._filterUnderOffsetMessage,[4,this._getLocalMessages(t,{nextLimit:this._limit})];case 1:return n=e.apply(this,[r.sent()]),[2]}})})})]):[2,[]];case 1:return i.sent(),0!==n.length&&(null===(e=this._backgroundSync)||void 0===e?void 0:e.isWrappingMessages(n))?[3,3]:[4,(0,s.F)(function(){return(0,s.b)(a,void 0,void 0,function(){var e,r,a,i,o;return(0,s.c)(this,function(u){switch(u.label){case 0:return e=s.V.of(this._iid).cacheContext,[4,this._getRemoteMessages(t,{nextLimit:this._limit,checkingContinuousMessages:e.localCacheEnabled})];case 1:return r=u.sent(),n=this._filterUnderOffsetMessage(r.messages),this._hasNext=n.length>=this._limit,n.length>0&&((a=this._syncRange).extends.apply(a,(0,s.o)([],(0,s.p)(n.map(function(e){return e.createdAt})),!1)),(null===(i=this._backgroundSync)||void 0===i?void 0:i.range.overlap(this._syncRange))&&r.isContinuousMessages&&(null===(o=this._backgroundSync)||void 0===o||o.range.extends(this._syncRange.bottom))),[2]}})})})];case 2:return i.sent(),this._addMessagesToView(n,s.ad.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=n.length>=this._limit,n.length>0&&((r=this._syncRange).extends.apply(r,(0,s.o)([],(0,s.p)(n.map(function(e){return e.createdAt})),!1)),this._addMessagesToView(n,s.ad.REQUEST_MESSAGE)),i.label=4;case 4:return[2,n]}})})},e.prototype.removeFailedMessage=function(e){return(0,s.b)(this,void 0,void 0,function(){var t;return(0,s.c)(this,function(n){switch(n.label){case 0:return[4,eq.of(this._iid).removeFailedMessageFromCache(e)];case 1:return n.sent(),(t=this._unsentMessages.findIndex(function(t){return t.reqId===e}))>-1&&this._unsentMessages.splice(t,1),[2]}})})},e.prototype.dispose=function(){var e,t,n,r=s.V.of(this._iid),a=r.cacheContext,o=r.dispatcher;this._channel._updateMessageCollectionLastAccessedAt(),o.dispatch(new i.m({channels:[this._channel],source:i.n.CHANNEL_LASTACCESSEDAT_UPDATED})),a.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop()),null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),null===(n=this._pollChangelogSync)||void 0===n||n.close();var u=eq.of(this._iid);u.unsubscribeGroupChannelEvent(this._key),u.unsubscribeMessageEvent(this._key),this._connectionEventContext&&this._connectionEventContext.close()},e}(),tr={coverUrl:null,coverImage:null,isDistinct:null,isPublic:null,isDiscoverable:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},ts={hidePreviousMessages:!1,allowAutoUnhide:!0},ta=function(e){function t(t){var n=this,r=t.channelUrl,a=t.token,i=t.limit,o=t.order,u=t.mutedMemberFilter,c=t.memberStateFilter,l=t.nicknameStartsWithFilter,h=t.operatorFilter;return(n=e.call(this)||this).method=s.A.GET,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r),"/members"),n.params={token:a,limit:i,order:o,muted_member_filter:u,member_state_filter:c,nickname_startswith:l,operator_filter:h,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},n}return(0,s._)(t,e),t}(s.f),ti=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.members=[];var s=n.next,a=n.members;return r.token=s,a&&a.length>0&&(r.members=a.map(function(e){return new b(t,e)})),r}return(0,s._)(t,e),t}(s.h);(tw=e8||(e8={})).ALL="all",tw.MUTED="muted",tw.UNMUTED="unmuted",(tD=e9||(e9={})).MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",tD.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical",(tL=te||(te={})).ALL="all",tL.JOINED="joined_only",tL.INVITED="invited_only",tL.INVITED_BY_FRIEND="invited_by_friend",tL.INVITED_BY_NON_FRIEND="invited_by_non_friend";var to=function(e){function t(t,n,r){var a,i,o,u,c=this;return(c=e.call(this,t,n,s.K.GROUP,r)||this).mutedMemberFilter=e8.ALL,c.memberStateFilter=te.ALL,c.nicknameStartsWithFilter=null,c.operatorFilter=v.ALL,c.order=e9.MEMBER_NICKNAME_ALPHABETICAL,c.mutedMemberFilter=null!==(a=r.mutedMemberFilter)&&void 0!==a?a:e8.ALL,c.memberStateFilter=null!==(i=r.memberStateFilter)&&void 0!==i?i:te.ALL,c.nicknameStartsWithFilter=null!==(o=r.nicknameStartsWithFilter)&&void 0!==o?o:null,c.order=null!==(u=r.order)&&void 0!==u?u:e9.MEMBER_NICKNAME_ALPHABETICAL,c}return(0,s._)(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&(0,s.H)(e8,this.mutedMemberFilter)&&(0,s.H)(te,this.memberStateFilter)&&((0,s.a)("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&(0,s.H)(v,this.operatorFilter)&&(0,s.H)(e9,this.order)},t.prototype.next=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a;return(0,s.c)(this,function(i){switch(i.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=s.V.of(this._iid).requestQueue,t=new ta((0,s.g)((0,s.g)({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=(n=i.sent().as(ti)).members,a=n.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw s.S.queryInProgress;case 4:return[3,6];case 5:throw s.S.invalidParameters;case 6:return[2]}})})},t}(s.ah),tu=function(e){function t(t){var n=this,r=t.channelUrl,a=t.userId,i=t.accessCode;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r),"/accept"),n.params={user_id:a,access_code:i},n}return(0,s._)(t,e),t}(s.f),tc=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new tW(t,n),r.channel.myMemberState=h.JOINED,r}return(0,s._)(t,e),t}(s.h),tl=function(e){function t(t){var n=this,r=t.channelUrl,a=t.isDistinct,i=t.isPublic,o=t.isDiscoverable,u=t.coverUrl,c=t.coverImage,l=t.accessCode,h=t.name,d=t.data,p=t.customType,_=t.operatorUserIds,f=t.messageSurvivalSeconds;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r)),n.params=(0,s.e)({is_distinct:a,is_public:i,is_discoverable:o,name:h,data:d,custom_type:p,cover_url:u,cover_file:c,access_code:l,operator_ids:_,message_survival_seconds:f}),n}return(0,s._)(t,e),t}(s.f),th=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.channel=new tW(t,n),r}return(0,s._)(t,e),t}(s.h),td=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=s.A.DELETE,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r)),n}return(0,s._)(t,e),t}(s.f);tk=s.h,(0,s._)(function(e,t){return tk.call(this,e,t)||this},tk);var tp=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=s.A.DELETE,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r),"/hide"),n}return(0,s._)(t,e),t}(s.f);tx=s.h,(0,s._)(function(){return null!==tx&&tx.apply(this,arguments)||this},tx);var t_=function(e){function t(t){var n=t.userId,r=t.channelUrl,a=t.countPreference,i=e.call(this)||this;return i.method=s.A.PUT,i.path="".concat(s.d,"/").concat(encodeURIComponent(n),"/count_preference/").concat(encodeURIComponent(r)),i.params={count_preference:a},i}return(0,s._)(t,e),t}(s.f),tf=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.countPreference=n.count_preference,r}return(0,s._)(t,e),t}(s.h),tm=function(e){function t(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=s.A.PUT,n.path="".concat(s.ac,"/").concat(encodeURIComponent(r),"/reset_user_history"),n}return(0,s._)(t,e),t}(s.f),tv=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.messageOffsetTimestamp=null;var s=n.ts_message_offset;return r.messageOffsetTimestamp=null!=s?s:null,r}return(0,s._)(t,e),t}(s.h),tg=(0,s.g)((0,s.g)({},a.E),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),ty=(0,s.g)((0,s.g)({},a.H),{scheduledAt:null}),tb=function(e){function t(t){var n,r=this;r=e.call(this)||this;var a=null;t.mentionType===s.$.USERS&&(t.mentionedUserIds?a=t.mentionedUserIds:t.mentionedUsers&&(a=t.mentionedUsers.map(function(e){return e.userId})));var i=t.channelType,o=t.channelUrl,c=t.scheduledMessageId;return r.method=s.A.PUT,r.path="".concat((0,s.a6)(i),"/").concat(encodeURIComponent(o),"/scheduled_messages/").concat(encodeURIComponent(c)),r.params=(0,s.e)({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:s.aw.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:t.thumbnailSizes?t.thumbnailSizes.map(function(e){return u.T.payloadify(e)}):[],custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:a,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map(function(e){return u.c.payloadify(e)}),apple_critical_alert_options:u.A.payloadify(t.appleCriticalAlertOptions),push_option:t.pushNotificationDeliveryOption}),r}return(0,s._)(t,e),t}(s.f),tE=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.message=new u.F(t,n),r}return(0,s._)(t,e),t}(s.h),tC=function(e){function t(t){var n,r=this;r=e.call(this)||this;var a=null;t.mentionType===s.$.USERS&&(t.mentionedUserIds?a=t.mentionedUserIds:t.mentionedUsers&&(a=t.mentionedUsers.map(function(e){return e.userId})));var i=t.channelType,o=t.channelUrl,c=t.scheduledMessageId;return r.method=s.A.PUT,r.path="".concat((0,s.a6)(i),"/").concat(encodeURIComponent(o),"/scheduled_messages/").concat(encodeURIComponent(c)),r.params=(0,s.e)({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:s.aw.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:a,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map(function(e){return u.c.payloadify(e)}),apple_critical_alert_options:u.A.payloadify(t.appleCriticalAlertOptions),target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption}),r}return(0,s._)(t,e),t}(s.f);tF=s.h,(0,s._)(function(e,t){var n=tF.call(this,e,t)||this;return n.message=new u.U(e,t),n},tF);var tM=function(e){function t(t){var n=e.call(this)||this,r=t.channelType,a=t.channelUrl,i=t.scheduledMessageId;return n.method=s.A.DELETE,n.path="".concat((0,s.a6)(r),"/").concat(encodeURIComponent(a),"/scheduled_messages/").concat(encodeURIComponent(i)),n}return(0,s._)(t,e),t}(s.f),tN=function(e){function t(t){var n=e.call(this)||this,r=t.channelType,a=t.channelUrl,i=t.scheduledMessageId;return n.method=s.A.POST,n.path="".concat((0,s.a6)(r),"/").concat(encodeURIComponent(a),"/scheduled_messages/").concat(encodeURIComponent(i),"/send_now"),n}return(0,s._)(t,e),t}(s.f),tS=function(e){function t(t){var n=t.userId,r=t.channelUrl,a=t.pushTriggerOption,i=e.call(this)||this;return i.method=s.A.PUT,i.path="".concat(s.d,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),i.params={push_trigger_option:a},i}return(0,s._)(t,e),t}(s.f),tU=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return(0,s._)(t,e),t}(s.h),tA=function(e){function t(t){var n=t.userId,r=t.channelUrl,a=e.call(this)||this;return a.method=s.A.GET,a.path="".concat(s.d,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),a}return(0,s._)(t,e),t}(s.f),tI=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return(0,s._)(t,e),t}(s.h),tT=function(e){function t(t){var n=t.channelType,r=t.channelUrl,a=t.messageId,i=e.call(this)||this;return i.method=s.A.POST,i.path="".concat((0,s.a6)(n),"/").concat(encodeURIComponent(r),"/messages/").concat(a,"/pin"),i}return(0,s._)(t,e),t}(s.f);tP=s.h,(0,s._)(function(e,t){return tP.call(this,e,t)||this},tP);var tw,tD,tL,tk,tx,tF,tP,tR,tO,tV,tG=function(e){function t(t){var n=t.channelType,r=t.channelUrl,a=t.messageId,i=e.call(this)||this;return i.method=s.A.DELETE,i.path="".concat((0,s.a6)(n),"/").concat(encodeURIComponent(r),"/messages/").concat(a,"/pin"),i}return(0,s._)(t,e),t}(s.f);tH=s.h,(0,s._)(function(e,t){return tH.call(this,e,t)||this},tH),(tq=tR||(tR={})).ALL="all",tq.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",tq.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",tq.OFF="off",(tB=tO||(tO={})).MUTED="muted",tB.UNMUTED="unmuted",(tz=tV||(tV={})).UNHIDDEN="unhidden",tz.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",tz.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide";var tH,tq,tB,tz,tj,tW=function(e){function t(t,n){var r,a,i,o,c,l,d,p,_,f,m,v,g,y,E,C,M,N,S,U=this;return(U=e.call(this,t,n)||this)._unreadMemberStateMap=new Map,U._undeliveredMemberStateMap=new Map,U._typingStatus=new Map,U._lastMemberCountUpdated=0,U._typingStarted=0,U._typingEnded=0,U.isDistinct=!1,U.isSuper=!1,U.isBroadcast=!1,U.isExclusive=!1,U.isPublic=!1,U.isDiscoverable=!0,U.isAccessCodeRequired=!1,U.isPushEnabled=!1,U.unreadMessageCount=0,U.unreadMentionCount=0,U.members=[],U.memberCount=0,U.joinedMemberCount=0,U.hiddenState=tV.UNHIDDEN,U.lastMessage=null,U.messageOffsetTimestamp=0,U.messageSurvivalSeconds=-1,U.myMemberState=h.NONE,U.myRole=s.R.NONE,U.myMutedState=tO.UNMUTED,U.myLastRead=0,U.myCountPreference=tR.ALL,U.myPushTriggerOption=s.I.DEFAULT,U.inviter=null,U.invitedAt=0,U.joinedAt=0,U.pinnedMessageIds=[],U.lastPinnedMessage=null,U._pinnedMessagesUpdatedAt=0,U.channelType=s.K.GROUP,U.isDistinct=null!==(a=n.is_distinct)&&void 0!==a&&a,U.isSuper=null!==(i=n.is_super)&&void 0!==i&&i,U.isBroadcast=null!==(o=n.is_broadcast)&&void 0!==o&&o,U.isExclusive=null!==(c=n.is_exclusive)&&void 0!==c&&c,U.isPublic=null!==(l=n.is_public)&&void 0!==l&&l,U.isDiscoverable=null!==(d=n.is_discoverable)&&void 0!==d?d:U.isPublic,U.isAccessCodeRequired=null!==(p=n.is_access_code_required)&&void 0!==p&&p,U.isPushEnabled=null!==(_=n.is_push_enabled)&&void 0!==_&&_,Array.isArray(n.members)&&(r=U.members).push.apply(r,(0,s.o)([],(0,s.p)(n.members.map(function(e){return new b(U._iid,e)})),!1)),U.memberCount=null!==(f=n.member_count)&&void 0!==f?f:0,U.joinedMemberCount=null!==(m=n.joined_member_count)&&void 0!==m?m:0,U.hiddenState=(0,s.H)(tV,n.hidden_state)?n.hidden_state:tV.UNHIDDEN,U.messageOffsetTimestamp=null!==(v=n.ts_message_offset)&&void 0!==v?v:0,U.messageSurvivalSeconds=null!==(g=n.message_survival_seconds)&&void 0!==g?g:-1,U.lastMessage=n.last_message?(0,u.p)(U._iid,(0,s.g)({channel_type:U.channelType},n.last_message)):null,n.read_receipt&&Object.keys(n.read_receipt).forEach(function(e){(0,s.a)("number",n.read_receipt[e])&&U._updateUnreadMemberState(e,n.read_receipt[e])}),n.delivery_receipt&&Object.keys(n.delivery_receipt).forEach(function(e){(0,s.a)("number",n.delivery_receipt[e])&&U._updateUndeliveredMemberState(e,n.delivery_receipt[e])}),U.myMemberState=(0,s.H)(h,n.member_state)?n.member_state:h.NONE,U.myRole=(0,s.H)(s.R,n.my_role)?n.my_role:s.R.NONE,(0,s.H)(tO,n.is_muted)?U.myMutedState=n.is_muted:(0,s.a)("boolean",n.is_muted)?U.myMutedState=n.is_muted?tO.MUTED:tO.UNMUTED:U.myMutedState=tO.UNMUTED,U.myCountPreference=(0,s.H)(tR,n.count_preference)?n.count_preference:tR.ALL,U.myPushTriggerOption=(0,s.H)(s.I,n.push_trigger_option)?n.push_trigger_option:s.I.ALL,U.myLastRead=null!==(y=n.user_last_read)&&void 0!==y?y:0,U.inviter=n.inviter?new s.U(U._iid,n.inviter):null,U.invitedAt=null!==(E=n.invited_at)&&void 0!==E?E:0,U.joinedAt=null!==(C=n.joined_ts)&&void 0!==C?C:0,U._updateUnreadCount(null!==(M=n.unread_message_count)&&void 0!==M?M:0,null!==(N=n.unread_mention_count)&&void 0!==N?N:0),U.pinnedMessageIds=null!==(S=n.pinned_message_ids)&&void 0!==S?S:[],U.lastPinnedMessage=n.latest_pinned_message?(0,u.p)(U._iid,(0,s.g)({channel_type:U.channelType},n.latest_pinned_message)):null,U}return(0,s._)(t,e),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.hiddenState!==tV.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isTyping",{get:function(){return this._typingStatus.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cachedUnreadMemberState",{get:function(){var e,t,n={};try{for(var r=(0,s.G)(this._unreadMemberStateMap),a=r.next();!a.done;a=r.next()){var i=(0,s.p)(a.value,2),o=i[0],u=i[1];n[o]=u}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cachedUndeliveredMemberState",{get:function(){var e,t,n={};try{for(var r=(0,s.G)(this._undeliveredMemberStateMap),a=r.next();!a.done;a=r.next()){var i=(0,s.p)(a.value,2),o=i[0],u=i[1];n[o]=u}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),t.payloadify=function(t){return t?(0,s.e)((0,s.g)((0,s.g)({},e.payloadify.call(this,t)),{is_access_code_required:t.isAccessCodeRequired,is_distinct:t.isDistinct,is_super:t.isSuper,is_broadcast:t.isBroadcast,is_exclusive:t.isExclusive,is_public:t.isPublic,is_discoverable:t.isDiscoverable,is_muted:t.myMutedState,is_push_enabled:t.isPushEnabled,unread_message_count:t.unreadMessageCount,unread_mention_count:t.unreadMentionCount,push_trigger_option:t.myPushTriggerOption,count_preference:t.myCountPreference,hidden_state:t.hiddenState,member_count:t.memberCount,joined_member_count:t.joinedMemberCount,member_state:t.myMemberState,my_role:t.myRole,user_last_read:t.myLastRead,ts_message_offset:t.messageOffsetTimestamp,message_survival_seconds:t.messageSurvivalSeconds,read_receipt:t.cachedUnreadMemberState,delivery_receipt:t.cachedUndeliveredMemberState,members:t.members.map(function(e){return b.payloadify(e)}),last_message:(0,u.l)(t.lastMessage),inviter:t.inviter?s.U.payloadify(t.inviter):null,invited_at:t.invitedAt,joined_ts:t.joinedAt,pinned_message_ids:t.pinnedMessageIds,latest_pinned_message:(0,u.l)(t.lastPinnedMessage)})):null},t.prototype._shouldUpdateLastMessageWith=function(e){return!(e instanceof u.S&&e.parentMessageId>0&&!e.replyToChannel)&&(!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt)},t.prototype._updateUnreadCount=function(e,t){if("number"==typeof e&&e>=0){if(this.myCountPreference===tR.ALL||this.myCountPreference===tR.UNREAD_MESSAGE_COUNT_ONLY){if(this.isExclusive||this.isSuper||this.isBroadcast){var n=s.V.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=n&&e>=n?n:e}else this.unreadMessageCount=e}else this.unreadMessageCount=0}else this.unreadMessageCount=0;"number"==typeof t&&t>=0&&(this.myCountPreference===tR.ALL||this.myCountPreference===tR.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=t:this.unreadMentionCount=0},t.prototype._updateUnreadMemberState=function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),s.V.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)},t.prototype._updateUndeliveredMemberState=function(e,t){var n=this._undeliveredMemberStateMap.get(e);return(!n||n<t)&&(this._undeliveredMemberStateMap.set(e,t),!0)},t.prototype._updateTypingStatus=function(e,t){void 0===t&&(t=(new Date).getTime()),t>0?this._typingStatus.set(e.userId,{user:e,ts:t}):this._typingStatus.delete(e.userId)},t.prototype._clearTypingStatus=function(){this._typingStatus.clear(),this._typingStarted=0,this._typingEnded=0},t.prototype._setLatestMemberCount=function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r},t.prototype.isReadMessage=function(e){var t=s.V.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return n&&n>=e.createdAt},t.prototype.serialize=function(){var e=this;return(0,s.Z)(this,function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState})},t.prototype.createMessageCollection=function(e){return void 0===e&&(e={}),new tn(this._iid,(0,s.g)({channel:this},e))},t.prototype.createMemberListQuery=function(e){return void 0===e&&(e={}),new to(this._iid,this.url,e)},t.prototype.addMember=function(e,t){if(void 0===t&&(t=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n=this.members.findIndex(function(t){return t.userId===e.userId});if(n>-1){var r=this.members[n];r.state===h.JOINED&&(e.state=r.state),this.members.splice(n,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,t),this._updateUndeliveredMemberState(e.userId,t)}},t.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=e instanceof b?e.userId:e,n=this.members.findIndex(function(e){return e.userId===t});if(n>-1)return this.members.splice(n,1),this.memberCount--,!0}return!1},t.prototype.getUnreadMemberCount=function(e){var t,n;if(e instanceof u.S&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=s.V.of(this._iid).sdkState,a=e.createdAt,i=0;try{for(var o=(0,s.G)(this.members),c=o.next();!c.done;c=o.next()){var l=c.value;r.userId!==l.userId&&l.state===h.JOINED&&e.sender.userId!==l.userId&&(this.cachedUnreadMemberState[l.userId]||0)<a&&i++}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}return 0},t.prototype.getUndeliveredMemberCount=function(e){var t,n;if(e instanceof u.S&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=s.V.of(this._iid).sdkState,a=e.createdAt,i=0;try{for(var o=(0,s.G)(this.members),c=o.next();!c.done;c=o.next()){var l=c.value;r.userId!==l.userId&&l.state===h.JOINED&&e.sender.userId!==l.userId&&(this.cachedUndeliveredMemberState[l.userId]||0)<a&&i++}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}return 0},t.prototype.getReadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=s.V.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var a=e instanceof u.S?e.sender:null,i=[];return this.members.forEach(function(s){(t||s.userId!==r.userId&&s.userId!==(null==a?void 0:a.userId))&&n._unreadMemberStateMap.get(s.userId)>=e.createdAt&&i.push(s)}),i},t.prototype.getUnreadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=s.V.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var a=e instanceof u.S?e.sender:null,i=[];return this.members.forEach(function(s){(t||s.userId!==r.userId&&s.userId!==(null==a?void 0:a.userId))&&n._unreadMemberStateMap.get(s.userId)<e.createdAt&&i.push(s)}),i},t.prototype.getReadStatus=function(e){var t=this;void 0===e&&(e=!1);var n=s.V.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var r={};return this.members.forEach(function(s){if(e||s.userId!==n.userId){var a=t._unreadMemberStateMap.get(s.userId);r[s.userId]=new E(t._iid,{channel_url:t.url,channel_type:t.channelType,user:b.payloadify(s),ts:a})}}),r},t.prototype.getTypingUsers=function(){var e=[];return this._typingStatus.forEach(function(t){var n=t.user;e.push(n)}),e},t.prototype.invalidateTypingStatus=function(){var e=this,t=s.V.of(this._iid).typingIndicatorInvalidateTime,n=Date.now(),r=!1;return this._typingStatus.forEach(function(s,a){n-s.ts>=t&&(e._typingStatus.delete(a),r=!0)}),r},t.prototype.refresh=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a;return(0,s.c)(this,function(o){switch(o.label){case 0:return t=(e=s.V.of(this._iid)).requestQueue,n=e.dispatcher,r=new W({channelUrl:this.url}),[4,t.send(r)];case 1:return a=o.sent().as(Q).channel,n.dispatch(new i.m({channels:[a],source:i.n.REQUEST_CHANNEL})),[2,a]}})})},t.prototype.freeze=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,e.prototype.freeze.call(this)];case 1:return t.sent(),s.V.of(this._iid).dispatcher.dispatch(new i.m({channels:[this],source:i.n.EVENT_CHANNEL_HIDDEN})),[2]}})})},t.prototype.unfreeze=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,e.prototype.unfreeze.call(this)];case 1:return t.sent(),s.V.of(this._iid).dispatcher.dispatch(new i.m({channels:[this],source:i.n.EVENT_CHANNEL_UNHIDDEN})),[2]}})})},t.prototype.updateChannel=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,o,u;return(0,s.c)(this,function(c){switch(c.label){case 0:return t=(0,s.g)((0,s.g)({},tr),e),(0,s.q)((0,s.a)("string",t.coverUrl,!0)&&((0,s.i)(t.coverImage)||(0,s.a)("string",t.coverImage)||null===t.coverImage)&&(0,s.a)("boolean",t.isDistinct,!0)&&(0,s.a)("boolean",t.isPublic,!0)&&(0,s.a)("boolean",t.isDiscoverable,!0)&&(0,s.a)("string",t.accessCode,!0)&&(0,s.a)("string",t.name,!0)&&(0,s.a)("string",t.data,!0)&&(0,s.a)("string",t.customType,!0)&&(0,s.l)("string",t.operatorUserIds,!0)&&(0,s.a)("number",t.messageSurvivalSeconds,!0)).throw(s.S.invalidParameters),r=(n=s.V.of(this._iid)).dispatcher,a=n.requestQueue,o=new tl((0,s.g)({channelUrl:this.url},t)),[4,a.send(o)];case 1:return u=c.sent().as(th).channel,r.dispatch(new i.m({channels:[u],source:i.n.EVENT_CHANNEL_UPDATED})),[2,u]}})})},t.prototype.invite=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){return(0,s.q)(e.every(function(e){return e instanceof s.U})).throw(s.S.invalidParameters),[2,this.inviteWithUserIds(e.map(function(e){return e.userId}))]})})},t.prototype.inviteWithUserIds=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,o;return(0,s.c)(this,function(u){switch(u.label){case 0:return(0,s.q)((0,s.l)("string",e)).throw(s.S.invalidParameters),n=(t=s.V.of(this._iid)).dispatcher,r=t.requestQueue,a=new ef({channelUrl:this.url,userIds:e}),[4,r.send(a)];case 1:return o=u.sent().as(em).channel,n.dispatch(new i.m({channels:[o],source:i.n.EVENT_CHANNEL_INVITED})),[2,o]}})})},t.prototype.join=function(e){return void 0===e&&(e=null),(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,o,u;return(0,s.c)(this,function(c){switch(c.label){case 0:return(0,s.q)((0,s.a)("string",e)||null===e).throw(s.S.invalidParameters),n=(t=s.V.of(this._iid)).dispatcher,r=t.sdkState,a=t.requestQueue,o=new el({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,a.send(o)];case 1:return(u=c.sent().as(eh).channel).myMemberState=this.myMemberState=h.JOINED,n.dispatch(new i.m({channels:[u],source:i.n.EVENT_CHANNEL_JOINED})),[2,this]}})})},t.prototype.leave=function(e){return void 0===e&&(e=!1),(0,s.b)(this,void 0,void 0,function(){var t,n,r,a;return(0,s.c)(this,function(i){switch(i.label){case 0:return n=(t=s.V.of(this._iid)).sdkState,r=t.requestQueue,a=new ep({channelUrl:this.url,userId:n.userId,shouldRemoveOperatorStatus:e}),[4,r.send(a)];case 1:return i.sent(),this.myMemberState=h.NONE,[2]}})})},t.prototype.acceptInvitation=function(e){return void 0===e&&(e=null),(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,o,u;return(0,s.c)(this,function(c){switch(c.label){case 0:return(0,s.q)((0,s.a)("string",e)||null===e).throw(s.S.invalidParameters),n=(t=s.V.of(this._iid)).dispatcher,r=t.sdkState,a=t.requestQueue,o=new tu({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,a.send(o)];case 1:return(u=c.sent().as(tc).channel).myMemberState=this.myMemberState=h.JOINED,n.dispatch(new i.m({channels:[u],source:i.n.EVENT_CHANNEL_ACCEPTED_INVITE})),[2,this]}})})},t.prototype.declineInvitation=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){switch(a.label){case 0:return t=(e=s.V.of(this._iid)).sdkState,n=e.requestQueue,r=new eg({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return a.sent(),this.myMemberState=h.NONE,[2,this]}})})},t.prototype.sendUserMessage=function(t){var n=this,r=new u.f,a=s.V.of(this._iid).dispatcher,o=i.d.of(this._iid);return e.prototype.sendUserMessage.call(this,t).onPending(function(e){o.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)}).onFailed(function(e,t){t&&o.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)}).onSucceeded(function(e){n.hiddenState===tV.HIDDEN_ALLOW_AUTO_UNHIDE&&(n.hiddenState=tV.UNHIDDEN),o.completeCurrentAndProcessNextAutoResend(e),n._shouldUpdateLastMessageWith(e)&&(n.lastMessage=e),eq.of(n._iid).handlers.map(function(e){return e.onChannelChanged(n)}),a.dispatch(new i.m({channels:[n],source:i.n.EVENT_MESSAGE_SENT})),r._trigger(null,e)}),r},t.prototype.updateUserMessage=function(t,n){return(0,s.b)(this,void 0,void 0,function(){var r,a,o,u,c=this;return(0,s.c)(this,function(l){switch(l.label){case 0:return r=s.V.of(this._iid).dispatcher,[4,e.prototype.updateUserMessage.call(this,t,n)];case 1:return a=l.sent(),o=!1,!a.silent&&this._shouldUpdateLastMessageWith(a)&&(this.lastMessage=a,o=!0),u=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===a.messageId&&(this.lastPinnedMessage=a,o=!0,u=!0),o&&(eq.of(this._iid).handlers.map(function(e){return e.onChannelChanged(c)}),r.dispatch(new i.m({channels:[this],source:u?i.n.EVENT_PINNED_MESSAGE_UPDATED:i.n.EVENT_MESSAGE_UPDATED}))),u&&eq.of(this._iid).handlers.map(function(e){return e.onPinnedMessageUpdated(c)}),r.dispatch(new s.ae({messages:[a],source:s.ad.EVENT_MESSAGE_UPDATED})),[2,a]}})})},t.prototype._autoResendUserMessage=function(t){var n=this,r=new u.f,a=s.V.of(this._iid).dispatcher,o=i.d.of(this._iid);return e.prototype._autoResendUserMessage.call(this,t).onPending(function(e){o.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)}).onFailed(function(e,t){o.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)}).onSucceeded(function(e){var t=eq.of(n._iid);o.completeCurrentAndProcessNextAutoResend(e),n._shouldUpdateLastMessageWith(e)&&(n.lastMessage=e),t.handlers.map(function(e){return e.onChannelChanged(n)}),a.dispatch(new i.m({channels:[n],source:i.n.EVENT_MESSAGE_SENT})),r._trigger(null,e)}),r},t.prototype.sendFileMessage=function(t){var n=this,r=new u.f,a=s.V.of(this._iid).dispatcher,o=i.d.of(this._iid);return e.prototype.sendFileMessage.call(this,t).onPending(function(e){o.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)}).onFailed(function(e,t){t&&o.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)}).onSucceeded(function(e){var t=eq.of(n._iid);o.completeCurrentAndProcessNextAutoResend(e),n._shouldUpdateLastMessageWith(e)&&(n.lastMessage=e),t.handlers.map(function(e){return e.onChannelChanged(n)}),a.dispatch(new i.m({channels:[n],source:i.n.EVENT_MESSAGE_SENT})),r._trigger(null,e)}),r},t.prototype.updateFileMessage=function(t,n){return(0,s.b)(this,void 0,void 0,function(){var r,a,o,u,c=this;return(0,s.c)(this,function(l){switch(l.label){case 0:return r=s.V.of(this._iid).dispatcher,[4,e.prototype.updateFileMessage.call(this,t,n)];case 1:return a=l.sent(),o=!1,!a.silent&&this._shouldUpdateLastMessageWith(a)&&(this.lastMessage=a,o=!0),u=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===a.messageId&&(this.lastPinnedMessage=a,o=!0,u=!0),o&&(eq.of(this._iid).handlers.map(function(e){return e.onChannelChanged(c)}),r.dispatch(new i.m({channels:[this],source:u?i.n.EVENT_PINNED_MESSAGE_UPDATED:i.n.EVENT_MESSAGE_UPDATED}))),u&&eq.of(this._iid).handlers.map(function(e){return e.onPinnedMessageUpdated(c)}),r.dispatch(new s.ae({messages:[a],source:s.ad.EVENT_MESSAGE_UPDATED})),[2,a]}})})},t.prototype._autoResendFileMessage=function(t){var n=this,r=new u.f,a=s.V.of(this._iid).dispatcher,o=i.d.of(this._iid);return e.prototype._autoResendFileMessage.call(this,t).onPending(function(e){o.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)}).onFailed(function(e,t){o.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)}).onSucceeded(function(e){var t=eq.of(n._iid);o.completeCurrentAndProcessNextAutoResend(e),n._shouldUpdateLastMessageWith(e)&&(n.lastMessage=e),t.handlers.map(function(e){return e.onChannelChanged(n)}),a.dispatch(new i.m({channels:[n],source:i.n.EVENT_MESSAGE_SENT})),r._trigger(null,e)}),r},t.prototype.deleteMessage=function(t){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(n){switch(n.label){case 0:return[4,e.prototype.deleteMessage.call(this,t)];case 1:return n.sent(),0===t.messageId&&t instanceof u.S&&s.V.of(this._iid).dispatcher.dispatch(new s.aB({reqId:t.reqId,source:s.ad.EVENT_MESSAGE_DELETED})),[2]}})})},t.prototype.hide=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,o,u,c;return(0,s.c)(this,function(l){switch(l.label){case 0:var h;return t=(0,s.g)((0,s.g)({},ts),e),(0,s.q)((h=t,(0,s.a)("boolean",h.hidePreviousMessages)&&(0,s.a)("boolean",h.allowAutoUnhide))).throw(s.S.invalidParameters),r=(n=s.V.of(this._iid)).dispatcher,a=n.sdkState,o=n.requestQueue,u=new ew((0,s.g)({channelUrl:this.url,userId:a.userId},t)),[4,o.send(u)];case 1:return c=l.sent().as(eD).messageOffsetTimestamp,this.hiddenState=t.allowAutoUnhide?tV.HIDDEN_ALLOW_AUTO_UNHIDE:tV.HIDDEN_PREVENT_AUTO_UNHIDE,t.hidePreviousMessages&&this._updateUnreadCount(0,0),c&&(this.messageOffsetTimestamp=c),r.dispatch(new i.m({channels:[this],source:i.n.EVENT_CHANNEL_HIDDEN})),[2,this]}})})},t.prototype.unhide=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){switch(a.label){case 0:return t=(e=s.V.of(this._iid)).dispatcher,n=e.requestQueue,r=new tp({channelUrl:this.url}),[4,n.send(r)];case 1:return a.sent(),this.hiddenState=tV.UNHIDDEN,t.dispatch(new i.m({channels:[this],source:i.n.EVENT_CHANNEL_UNHIDDEN})),[2,this]}})})},t.prototype.delete=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t;return(0,s.c)(this,function(n){switch(n.label){case 0:return e=s.V.of(this._iid).requestQueue,t=new td({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[2]}})})},t.prototype.markAsRead=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,u=this;return(0,s.c)(this,function(c){switch(c.label){case 0:return t=(e=s.V.of(this._iid)).sdkState,n=e.dispatcher,r=e.requestQueue,a=new eb({channelUrl:this.url}),[4,r.send(a)];case 1:return o=c.sent().as(eE).readStatus,this._updateUnreadMemberState(t.userId,o.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),eq.of(this._iid).handlers.map(function(e){return e.onChannelChanged(u)})),n.dispatch(new i.m({channels:[this],source:i.n.EVENT_CHANNEL_READ})),[2]}})})},t.prototype.markAsDelivered=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){switch(a.label){case 0:return t=(e=s.V.of(this._iid)).sdkState,n=e.requestQueue,r=new eC({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return a.sent(),[2]}})})},t.prototype.startTyping=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a;return(0,s.c)(this,function(i){return t=(e=s.V.of(this._iid)).requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingStarted>=n&&(this._typingStarted=r,this._typingEnded=0,a=new ek({channelUrl:this.url,time:this._typingStarted}),t.send(a)),[2]})})},t.prototype.endTyping=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a;return(0,s.c)(this,function(i){return t=(e=s.V.of(this._iid)).requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingEnded>=n&&(this._typingStarted=0,this._typingEnded=r,a=new eF({channelUrl:this.url,time:this._typingStarted}),t.send(a)),[2]})})},t.prototype.createScheduledUserMessage=function(e){e=(0,s.g)((0,s.g)({},i.S),e),(0,s.q)((0,i.v)(e)).throw(s.S.invalidParameters);var t=new u.f;return this._createScheduledUserMessage(e,t),t},t.prototype.updateScheduledUserMessage=function(e,t){return(0,s.b)(this,void 0,void 0,function(){var n,r,i;return(0,s.c)(this,function(o){switch(o.label){case 0:return n=(0,s.g)((0,s.g)({},ty),t),(0,s.q)((0,a.I)(n)&&(0,s.a)("number",n.scheduledAt,!0)).throw(s.S.invalidParameters),r=s.V.of(this._iid).requestQueue,i=new tC((0,s.g)({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,r.send(i)];case 1:return[2,o.sent().as(a.J).message]}})})},t.prototype.createScheduledFileMessage=function(e){var t=this;e=(0,s.g)((0,s.g)({},i.q),e),(0,s.q)((0,i.r)(e)).throw(s.S.invalidParameters);var n=Date.now(),r=this._generateRequestId(),o=new u.f;return(0,s.a9)(a.K).then(function(){var a=t._createPendingScheduledFileMessage(e,r,n);(0,s.w)(function(){return(0,s.b)(t,void 0,void 0,function(){return(0,s.c)(this,function(e){return[2,o._trigger(null,a)]})})})}),(0,s.i)(e.file)?this._uploadFileAndUpdateParams(e).then(function(){return t._createScheduledFileMessage(e,o,r,n)}):this._createScheduledFileMessage(e,o,r,n),o},t.prototype.updateScheduledFileMessage=function(e,t){return(0,s.b)(this,void 0,void 0,function(){var n,r;return(0,s.c)(this,function(i){switch(i.label){case 0:var o;return n=(0,s.g)((0,s.g)({},tg),t),(0,s.q)((o=n,(0,a.G)(o)&&(0,s.a)("number",o.scheduledAt,!0)&&((0,s.i)(o.file)||(0,s.a)("string",o.fileUrl))&&(0,s.a)("string",o.fileName,!0)&&(0,s.a)("string",o.mimeType,!0)&&(0,s.a)("number",o.fileSize,!0)&&(null===o.thumbnailSizes||o.thumbnailSizes.every(function(e){return(0,s.a)("object",e)&&e.maxWidth>0&&e.maxHeight>0})))).throw(s.S.invalidParameters),(0,s.i)(n.file)?[4,this._uploadFileAndUpdateParams(n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return r=new tb((0,s.g)({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,s.V.of(this._iid).requestQueue.send(r)];case 3:return[2,i.sent().as(tE).message]}})})},t.prototype.cancelScheduledMessage=function(e){return(0,s.b)(this,void 0,void 0,function(){var t;return(0,s.c)(this,function(n){switch(n.label){case 0:return t=new tM({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,s.V.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}})})},t.prototype.sendScheduledMessageNow=function(e){return(0,s.b)(this,void 0,void 0,function(){var t;return(0,s.c)(this,function(n){switch(n.label){case 0:return t=new tN({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,s.V.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}})})},t.prototype.getMyPushTriggerOption=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a;return(0,s.c)(this,function(i){switch(i.label){case 0:return t=(e=s.V.of(this._iid)).sdkState,n=e.requestQueue,r=new tA({userId:t.userId,channelUrl:this.url}),[4,n.send(r)];case 1:return a=i.sent().as(tI).pushTriggerOption,this.myPushTriggerOption=a,[2,a]}})})},t.prototype.setMyPushTriggerOption=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,o,u;return(0,s.c)(this,function(c){switch(c.label){case 0:return(0,s.q)((0,s.H)(s.I,e)).throw(s.S.invalidParameters),n=(t=s.V.of(this._iid)).dispatcher,r=t.sdkState,a=t.requestQueue,o=new tS({userId:r.userId,channelUrl:this.url,pushTriggerOption:e}),[4,a.send(o)];case 1:return u=c.sent().as(tU).pushTriggerOption,this.myPushTriggerOption=u,n.dispatch(new i.m({channels:[this],source:i.n.EVENT_CHANNEL_UPDATED})),[2,u]}})})},t.prototype.setMyCountPreference=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,o,u;return(0,s.c)(this,function(c){switch(c.label){case 0:return(0,s.q)((0,s.H)(tR,e)).throw(s.S.invalidParameters),n=(t=s.V.of(this._iid)).dispatcher,r=t.sdkState,a=t.requestQueue,o=new t_({channelUrl:this.url,userId:r.userId,countPreference:e}),[4,a.send(o)];case 1:return u=c.sent().as(tf).countPreference,this.myCountPreference=u,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),n.dispatch(new i.m({channels:[this],source:i.n.EVENT_CHANNEL_UPDATED})),[2,u]}})})},t.prototype.resetMyHistory=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a;return(0,s.c)(this,function(o){switch(o.label){case 0:return t=(e=s.V.of(this._iid)).dispatcher,n=e.requestQueue,r=new tm({channelUrl:this.url}),[4,n.send(r)];case 1:return a=o.sent().as(tv).messageOffsetTimestamp,this.messageOffsetTimestamp=a,t.dispatch(new i.m({channels:[this],source:i.n.EVENT_CHANNEL_RESET_HISTORY})),[2,this]}})})},t.prototype.pinMessage=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n;return(0,s.c)(this,function(r){switch(r.label){case 0:return(0,s.q)((0,s.a)("number",e)&&e>0).throw(s.S.invalidParameters),t=s.V.of(this._iid).requestQueue,n=new tT({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}})})},t.prototype.unpinMessage=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n;return(0,s.c)(this,function(r){switch(r.label){case 0:return(0,s.q)((0,s.a)("number",e)&&e>0).throw(s.S.invalidParameters),t=s.V.of(this._iid).requestQueue,n=new tG({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}})})},t.prototype._uploadFileAndUpdateParams=function(e){return(0,s.b)(this,void 0,void 0,function(){var t,n,r,a,i,o,c,l,h,d;return(0,s.c)(this,function(p){switch(p.label){case 0:return(0,s.i)(e.file)?(t=s.V.of(this._iid).requestQueue,n=new u.n({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),[4,t.send(n)]):[3,2];case 1:a=(r=p.sent().as(u.m)).url,o=void 0===(i=r.fileSize)?e.fileSize:i,l=void 0===(c=r.thumbnailSizes)?e.thumbnailSizes:c,d=void 0!==(h=r.requireAuth)&&h,e.fileUrl=a,e.fileSize=o,e.thumbnailSizes=l,e.requireAuth=d,p.label=2;case 2:return[2]}})})},t}(a.f),tQ={},tK=function(){function e(e){var t,n=e._iid,r=e.limit,a=this;this._sync=null,this._connectionEventContext=null,this.ref=0,this._metadata=null,this._iid=n,this._limit=void 0===r?100:r;var o,u=s.V.of(this._iid),c=u.sdkState,l=u.dispatcher,h=u.logger;this._metadataKey=(o=c.userId,"sendbird:".concat(o,"@groupchannel/sync.meta"));var d=(t=c.userId,"sendbird:".concat(t,"@groupchannel/sync"));this._sync=new ej(d,function(){return(0,s.b)(a,void 0,void 0,function(){var e,t,n,r,a,o;return(0,s.c)(this,function(u){switch(u.label){case 0:return e={hasNext:!0,nextToken:""},[4,this.loadMetadata()];case 1:if(u.sent(),h.debug("channel background sync from",this._metadata.token),this._metadata.completed)return[3,9];u.label=2;case 2:return u.trys.push([2,5,,8]),[4,eq.of(this._iid).getMyGroupChannels(this._metadata.token,{includeEmpty:!0,order:i.G.CHRONOLOGICAL},this._limit,i.n.SYNC_CHANNEL_BACKGROUND)];case 3:return n=(t=u.sent()).channels,r=t.token,e.hasNext=n.length>=this._limit&&!!r,e.nextToken=r,this._metadata.token=r,(o=this._metadata.range).extends.apply(o,(0,s.o)([],(0,s.p)(n.map(function(e){return e.createdAt})),!1)),this._metadata.completed=!e.hasNext,h.debug("channel background sync progress",e),[4,this.saveMetadata()];case 4:return u.sent(),[3,8];case 5:return a=u.sent(),h.debug("channel background sync error",a),a instanceof s.S&&a.isInvalidTokenError?[4,this.clearMetaData()]:[3,7];case 6:u.sent(),u.label=7;case 7:throw a;case 8:return[3,10];case 9:e.hasNext=!1,e.nextToken="",u.label=10;case 10:return[2,e]}})})}),this._connectionEventContext=l.on(function(e){e instanceof s.s&&(e.stateType===s.t.CONNECTED?a.resume():a.pause())})}return e.of=function(t){return tQ[t]||(tQ[t]=new e({_iid:t})),tQ[t].ref++,tQ[t]},e.clear=function(e){tQ[e]&&(tQ[e].close(),delete tQ[e])},Object.defineProperty(e.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"completed",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)},enumerable:!1,configurable:!0}),e.prototype.loadMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){var e;return(0,s.c)(this,function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,s.V.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={token:e?e.token:"",range:new eV(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!e&&e.completed},t.label=2;case 2:return[2,this._metadata]}})})},e.prototype.saveMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return this._metadata?[4,s.V.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}})})},e.prototype.clearMetaData=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,s.V.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}})})},e.prototype.resume=function(){var e,t,n=s.V.of(this._iid),r=n.logger;n.connectionManager.isConnected&&(r.debug("channel background sync resume()"),this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:""))},e.prototype.pause=function(){s.V.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete tQ[this._iid])},e}(),tY={},tJ=function(){function e(e){var t,n=e._iid,r=this;this._sync=null,this._connectionEventContext=null,this.ref=0,this._metadataKey=null,this._metadata=null,this._iid=n;var a,o=s.V.of(this._iid),u=o.logger,c=o.sdkState,l=o.dispatcher;this._metadataKey=(a=c.userId,"sendbird:".concat(a,"@groupchannel/changelogs.meta"));var h=(t=c.userId,"sendbird:".concat(t,"@groupchannel/changelogs"));this._sync=new ej(h,function(){return(0,s.b)(r,void 0,void 0,function(){var e,t,n,r,a;return(0,s.c)(this,function(o){switch(o.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:o.sent(),u.debug("channel changelog sync from",this._metadata.token),o.label=2;case 2:return o.trys.push([2,5,,8]),[4,eq.of(this._iid).getMyGroupChannelChangeLogs(this._metadata.token,{},i.n.SYNC_CHANNEL_CHANGELOGS)];case 3:return n=(t=o.sent()).hasMore,r=t.token,e.hasNext=n,e.nextToken=r,this._metadata.token=r,u.debug("channel changelog sync progress",e),[4,this.saveMetadata()];case 4:return o.sent(),[3,8];case 5:return a=o.sent(),u.debug("channel changelog sync error",a),a instanceof s.S&&a.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:o.sent(),o.label=7;case 7:throw a;case 8:return[2,e]}})})}),this._connectionEventContext=l.on(function(e){e instanceof s.s&&(e.stateType===s.t.CONNECTED?r.resume():r.pause())})}return e.of=function(t){return tY[t]||(tY[t]=new e({_iid:t})),tY[t].ref++,tY[t]},e.clear=function(e){tY[e]&&(tY[e].close(),delete tY[e])},e.prototype.loadMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r;return(0,s.c)(this,function(a){switch(a.label){case 0:return this._metadata?[3,2]:(t=(e=s.V.of(this._iid)).cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=a.sent(),this._metadata={token:r?r.token:n},a.label=2;case 2:return[2,this._metadata]}})})},e.prototype.saveMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return this._metadata?[4,s.V.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}})})},e.prototype.clearMetadata=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,s.V.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=null,[2]}})})},e.prototype.resume=function(){s.V.of(this._iid).connectionManager.isConnected&&this._sync.start(0)},e.prototype.pause=function(){this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete tY[this._iid])},e}(),tX=function(){function e(e,t){var n=t.filter,r=t.order,o=t.limit,u=this;this.channels=[],this._backgroundSync=null,this._changelogSync=null,this._iid=e,this._key="gcc-".concat((0,s.u)()),this.filter=null!=n?n:new D,this.order=null!=r?r:i.G.LATEST_LAST_MESSAGE,this._hasMore=!0,this._token="",this._limit=null!=o?o:a.o;var c=s.V.of(this._iid),l=c.sdkState;c.cacheContext.localCacheEnabled&&(this._backgroundSync=tK.of(e),this._backgroundSync.resume()),this._changelogSync=tJ.of(e),this._changelogSync.resume(),eq.of(this._iid).subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n=e.filter(function(e){return u.filter.match(e,l.userId)}),r=e.filter(function(e){return!u.filter.match(e,l.userId)}).map(function(e){return e.url});n.length>0&&u._addChannelsToView(n,t),r.length>0&&u._removeChannelsFromView(r,t)},onRemove:function(e,t){u._removeChannelsFromView(e,t)}})}return Object.defineProperty(e.prototype,"hasMore",{get:function(){return this._hasMore},enumerable:!1,configurable:!0}),e.prototype.setGroupChannelCollectionHandler=function(e){this._handler=e},e.prototype._addChannelsToView=function(e,t,n){var r,a,o=this;void 0===n&&(n=!1);var u=[],c=[];try{for(var l=(0,s.G)(e),h=l.next();!h.done;h=l.next()){var d=h.value,p=e1(this.channels,d,this.order),_=p.place;if(p.contains)switch(c.push(d),t){case i.n.EVENT_CHANNEL_UPDATED:case i.n.EVENT_MESSAGE_RECEIVED:this.channels.splice(_,1);var f=e1(this.channels,d,this.order).place;this.channels.splice(f,0,d);break;default:this.channels[_]=d}else _===this.channels.length?(n||!this._backgroundSync||this._backgroundSync.completed)&&(u.push(d),this.channels.push(d)):(u.push(d),this.channels.splice(_,0,d))}}catch(e){r={error:e}}finally{try{h&&!h.done&&(a=l.return)&&a.call(l)}finally{if(r)throw r.error}}(0,i.s)(t)&&(0,s.w)(function(){return(0,s.b)(o,void 0,void 0,function(){var e,n,r;return(0,s.c)(this,function(s){return e=new eW(t),u.length>0&&(null===(n=this._handler)||void 0===n?void 0:n.onChannelsAdded)&&this._handler.onChannelsAdded(e,u),c.length>0&&(null===(r=this._handler)||void 0===r?void 0:r.onChannelsUpdated)&&this._handler.onChannelsUpdated(e,c),[2]})})})},e.prototype._removeChannelsFromView=function(e,t){var n,r,a=this,o=[],u=function(e){var t=c.channels.findIndex(function(t){return t.url===e});t>=0&&(o.push(c.channels[t].url),c.channels.splice(t,1))},c=this;try{for(var l=(0,s.G)(e),h=l.next();!h.done;h=l.next())u(h.value)}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return(0,i.s)(t)&&o.length>0&&(0,s.w)(function(){return(0,s.b)(a,void 0,void 0,function(){var e,n;return(0,s.c)(this,function(r){return e=new eW(t),(null===(n=this._handler)||void 0===n?void 0:n.onChannelsDeleted)&&this._handler.onChannelsDeleted(e,o),[2]})})}),o},e.prototype._getLocalChannels=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t;return(0,s.c)(this,function(n){switch(n.label){case 0:return e=eq.of(this._iid),t=this.channels.length>0?function(e,t){var n,r;switch(t){case i.G.LATEST_LAST_MESSAGE:return null!==(r=null===(n=e.lastMessage)||void 0===n?void 0:n.createdAt)&&void 0!==r?r:e.createdAt;case i.G.CHRONOLOGICAL:return e.createdAt;case i.G.CHANNEL_NAME_ALPHABETICAL:return e.name}return null}(this.channels[this.channels.length-1],this.order):null,[4,e.getChannelsFromCache(t,this.filter,this.order,this._limit)];case 1:return[2,n.sent()]}})})},e.prototype._getRemoteChannels=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n;return(0,s.c)(this,function(r){switch(r.label){case 0:return[4,eq.of(this._iid).getMyGroupChannels(this._token,(0,s.g)((0,s.g)({},this.filter),{order:this.order}),this._limit)];case 1:return t=(e=r.sent()).channels,n=e.token,this._token=n,this._hasMore=!!n,[2,t]}})})},e.prototype.loadMore=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t=this;return(0,s.c)(this,function(n){switch(n.label){case 0:return this._hasMore?(e=[],[4,(0,s.F)(function(){return(0,s.b)(t,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this._getLocalChannels()];case 1:return e=t.sent(),[2]}})})})]):[3,3];case 1:return n.sent(),[4,(0,s.F)(function(){return(0,s.b)(t,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this._getRemoteChannels()];case 1:return e=t.sent(),[2]}})})})];case 2:return n.sent(),this._addChannelsToView(e,i.n.REQUEST_CHANNEL,!0),[2,e];case 3:return[2,[]]}})})},e.prototype.dispose=function(){var e,t;null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),eq.of(this._iid).unsubscribeGroupChannelEvent(this._key)},e}(),tZ=function(e){function t(t){var n=this,r=t.token,a=t.limit,i=t.order,o=t.includeEmpty,u=t.membershipFilter,c=t.channelNameContainsFilter,l=t.channelUrlsFilter,h=t.customTypesFilter,p=t.customTypeStartsWithFilter,_=t.superChannelFilter,f=t.metadataOrderKeyFilter,m=t.metadataKey,v=t.metadataValues,g=t.metadataValueStartsWith,y=t.includeFrozen,b=t.includeMetaData;return(n=e.call(this)||this).method=s.A.GET,n.path=s.ac,n.params=(0,s.e)({token:r,limit:a,order:i,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:o,public_mode:d.PUBLIC,public_membership_mode:u,name_contains:c,channel_urls:l,custom_types:h,custom_type_startswith:p,super_mode:_,metadata_order_key:f,metadata_key:m,metadata_values:v,metadata_value_startswith:g,show_frozen:y,show_metadata:b}),n}return(0,s._)(t,e),t}(s.f),t$=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.channels=[],r.ts=null;var s=n.next,a=n.channels,i=n.ts;return r.token=s,a&&a.length>0&&(r.channels=a.map(function(e){return e.ts=i,new tW(t,e)})),r.ts="number"==typeof i?i:null,r}return(0,s._)(t,e),t}(s.h);(r=tj||(tj={})).ALL="all",r.JOINED="joined";var t0=function(e){function t(t,n){var r,s,a,o,u,c,l,h,d,p,f,m,v,g,y=this;return(y=e.call(this,t,n)||this).includeEmpty=!1,y.includeFrozen=!0,y.includeMetaData=!0,y.channelUrlsFilter=null,y.customTypesFilter=null,y.customTypeStartsWithFilter=null,y.channelNameContainsFilter=null,y.membershipFilter=tj.ALL,y.superChannelFilter=_.ALL,y.metadataKey=null,y.metadataValues=null,y.metadataOrderKeyFilter=null,y.metadataValueStartsWith=null,y.order=i.P.CHRONOLOGICAL,y.includeEmpty=null!==(r=n.includeEmpty)&&void 0!==r&&r,y.includeFrozen=null===(s=n.includeFrozen)||void 0===s||s,y.includeMetaData=null===(a=n.includeMetaData)||void 0===a||a,y.channelUrlsFilter=null!==(o=n.channelUrlsFilter)&&void 0!==o?o:null,y.customTypesFilter=null!==(u=n.customTypesFilter)&&void 0!==u?u:null,y.customTypeStartsWithFilter=null!==(c=n.customTypeStartsWithFilter)&&void 0!==c?c:null,y.channelNameContainsFilter=null!==(l=n.channelNameContainsFilter)&&void 0!==l?l:null,y.membershipFilter=null!==(h=n.membershipFilter)&&void 0!==h?h:tj.ALL,y.superChannelFilter=null!==(d=n.superChannelFilter)&&void 0!==d?d:_.ALL,y.metadataKey=null!==(p=n.metadataKey)&&void 0!==p?p:null,y.metadataValues=null!==(f=n.metadataValues)&&void 0!==f?f:null,y.metadataOrderKeyFilter=null!==(m=n.metadataOrderKeyFilter)&&void 0!==m?m:null,y.metadataValueStartsWith=null!==(v=n.metadataValueStartsWith)&&void 0!==v?v:null,y.order=null!==(g=n.order)&&void 0!==g?g:i.P.CHRONOLOGICAL,y}return(0,s._)(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&(0,s.a)("boolean",this.includeEmpty)&&(0,s.a)("boolean",this.includeFrozen)&&(0,s.a)("boolean",this.includeMetaData)&&(0,s.a)("string",this.channelNameContainsFilter,!0)&&(0,s.l)("string",this.channelUrlsFilter,!0)&&(0,s.l)("string",this.customTypesFilter,!0)&&(0,s.a)("string",this.customTypeStartsWithFilter,!0)&&(0,s.H)(tj,this.membershipFilter)&&(0,s.H)(_,this.superChannelFilter)&&(0,s.H)(i.P,this.order)&&(0,s.a)("string",this.metadataOrderKeyFilter,!0)&&(0,s.a)("string",this.metadataKey,!0)&&(0,s.l)("string",this.metadataValues,!0)&&(0,s.a)("string",this.metadataValueStartsWith,!0)},t.prototype.next=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,u,c;return(0,s.c)(this,function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,n=(t=s.V.of(this._iid)).requestQueue,r=t.dispatcher,a=new tZ((0,s.g)((0,s.g)({},this),{token:this._token})),[4,n.send(a)]):[3,2]):[3,5];case 1:return u=(o=l.sent().as(t$)).channels,c=o.token,this._token=c,this._hasNext=!!c,r.dispatch(new i.m({channels:u,source:i.n.REQUEST_CHANNEL})),this._isLoading=!1,[2,u];case 2:return[2,e];case 3:throw s.S.queryInProgress;case 4:return[3,6];case 5:throw s.S.invalidParameters;case 6:return[2]}})})},t}(s.B),t1=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach(function(e){n.hasOwnProperty(e)&&(n[e]=t[e])}),n}return(0,s._)(t,e),t}(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUserJoined=s.n,t.onUserLeft=s.n,t.onUserReceivedInvitation=s.n,t.onUserDeclinedInvitation=s.n,t.onChannelHidden=s.n,t.onUnreadMemberStatusUpdated=s.n,t.onUndeliveredMemberStatusUpdated=s.n,t.onTypingStatusUpdated=s.n,t.onPollUpdated=s.n,t.onPollVoted=s.n,t.onPollDeleted=s.n,t.onPinnedMessageUpdated=s.n,t}return(0,s._)(t,e),t}(o.B)),t2=function(e){function t(t){var n=this,r=t.token,a=t.limit,i=t.order,o=t.reverse,u=t.channelUrl,c=t.messageTypeFilter,l=t.scheduledStatus;return(n=e.call(this)||this).method=s.A.GET,n.path="".concat(s.aD),n.params=(0,s.e)({limit:a,reverse:o,channel_url:u,order:i,status:l}),r&&(n.params.token=r),c&&(n.params.message_type=c),n}return(0,s._)(t,e),t}(s.f),t3=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.token=null,r.scheduledMessages=[];var s=n.next,a=n.scheduled_messages;return r.token=s,r.scheduledMessages=a.map(function(e){return(0,u.p)(t,e)}),r}return(0,s._)(t,e),t}(s.h),t4=function(e){function t(t,n){var r,a,i,o,u,c=this;return(c=e.call(this,t,n)||this).channelUrl=null,c.order=null,c.reverse=!1,c.scheduledStatus=null,c.messageTypeFilter=s.a2.ALL,c.channelUrl=null!==(r=n.channelUrl)&&void 0!==r?r:null,c.order=null!==(a=n.order)&&void 0!==a?a:null,c.reverse=null!==(i=n.reverse)&&void 0!==i&&i,c.scheduledStatus=null!==(o=n.scheduledStatus)&&void 0!==o?o:null,c.messageTypeFilter=null!==(u=n.messageTypeFilter)&&void 0!==u?u:s.a2.ALL,c}return(0,s._)(t,e),t.prototype._validate=function(){return e.prototype._validate.call(this)&&(0,s.a)("string",this.channelUrl,!0)&&((0,s.H)(i.t,this.order)||null===this.order)&&(0,s.a)("boolean",this.reverse)&&((0,s.l)(u.j,this.scheduledStatus)||null===this.scheduledStatus)&&(0,s.H)(s.a2,this.messageTypeFilter)},t.prototype.next=function(){return(0,s.b)(this,void 0,void 0,function(){var e,t,n,r,a;return(0,s.c)(this,function(i){switch(i.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=s.V.of(this._iid).requestQueue,t=new t2((0,s.g)((0,s.g)({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=(n=i.sent().as(t3)).scheduledMessages,a=n.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw s.S.queryInProgress;case 4:return[3,6];case 5:throw s.S.invalidParameters;case 6:return[2]}})})},t}(s.B),t7=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="groupChannel",t}return(0,s._)(t,e),t.prototype.init=function(t,n){var r=n.sdkState,s=n.dispatcher,a=n.sessionManager,i=n.requestQueue,o=n.logger,u=n.onlineDetector,c=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:s,sessionManager:a,requestQueue:i,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new eq(t,{sdkState:r,cacheContext:c,dispatcher:s,sessionManager:a,requestQueue:i,logger:o})},t.prototype.createGroupChannelCollection=function(e){return void 0===e&&(e={}),new tX(this._iid,e)},t.prototype.createMyGroupChannelListQuery=function(e){return void 0===e&&(e={}),new eO(this._iid,e)},t.prototype.createPublicGroupChannelListQuery=function(e){return void 0===e&&(e={}),new t0(this._iid,e)},t.prototype.createScheduledMessageListQuery=function(e){return void 0===e&&(e={}),new t4(this._iid,e)},t.prototype.addGroupChannelHandler=function(e,t){(0,s.q)((0,s.a)("string",e)&&t instanceof t1).throw(s.S.invalidParameters),this._manager.addHandler(e,t)},t.prototype.removeGroupChannelHandler=function(e){(0,s.q)((0,s.a)("string",e)).throw(s.S.invalidParameters),this._manager.removeHandler(e)},t.prototype.removeAllGroupChannelHandlers=function(){this._manager.clearHandler()},t.prototype.buildGroupChannelFromSerializedData=function(e){return this._manager.buildGroupChannelFromSerializedData(e)},t.prototype.buildGroupChannelListQueryFromSerializedData=function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)},t.prototype.buildMemberFromSerializedData=function(e){return this._manager.buildMemberFromSerializedData(e)},t.prototype.getChannel=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){return(0,s.q)((0,s.a)("string",e)).throw(s.S.invalidParameters),[2,this._manager.getChannel(e)]})})},t.prototype.getChannelWithoutCache=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){return(0,s.q)((0,s.a)("string",e)).throw(s.S.invalidParameters),[2,this._manager.getChannelWithoutCache(e)]})})},t.prototype.getMyGroupChannelChangeLogsByToken=function(e,t){return void 0===t&&(t={}),(0,s.b)(this,void 0,void 0,function(){var n;return(0,s.c)(this,function(r){switch(r.label){case 0:return n=(0,s.g)((0,s.g)({},F),t),(0,s.q)((0,s.a)("string",e)&&P(n)).throw(s.S.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,r.sent()]}})})},t.prototype.getMyGroupChannelChangeLogsByTimestamp=function(e,t){return void 0===t&&(t={}),(0,s.b)(this,void 0,void 0,function(){var n;return(0,s.c)(this,function(r){switch(r.label){case 0:return n=(0,s.g)((0,s.g)({},F),t),(0,s.q)((0,s.a)("number",e)&&P(n)).throw(s.S.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,n)];case 1:return[2,r.sent()]}})})},t.prototype.getGroupChannelCount=function(e){return(0,s.b)(this,void 0,void 0,function(){var t;return(0,s.c)(this,function(n){return t=(0,s.g)((0,s.g)({},R),e),(0,s.q)(O(t)).throw(s.S.invalidParameters),[2,this._manager.getGroupChannelCount(t)]})})},t.prototype.getUnreadItemCount=function(e){return void 0===e&&(e={}),(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this._manager.getUnreadItemCount(e)];case 1:return[2,t.sent()]}})})},t.prototype.getTotalUnreadChannelCount=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){switch(e.label){case 0:return[4,this._manager.getTotalUnreadChannelCount()];case 1:return[2,e.sent()]}})})},t.prototype.getTotalUnreadMessageCount=function(e){return void 0===e&&(e={}),(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this._manager.getTotalUnreadMessageCount(e)];case 1:return[2,t.sent()]}})})},t.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return[4,this._manager.getTotalScheduledMessageCount(e)];case 1:return[2,t.sent()]}})})},t.prototype.getSubscribedTotalUnreadMessageCount=function(){return this._manager.getSubscribedTotalUnreadMessageCount()},t.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){return this._manager.getSubscribedCustomTypeTotalUnreadMessageCount()},t.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){return this._manager.getSubscribedCustomTypeUnreadMessageCount(e)},t.prototype.createChannel=function(e){return void 0===e&&(e={}),(0,s.b)(this,void 0,void 0,function(){var t;return(0,s.c)(this,function(n){return t=(0,s.g)((0,s.g)({},k),e),(0,s.q)(x(t)).throw(s.S.invalidParameters),[2,this._manager.createChannel(t)]})})},t.prototype.createDistinctChannelIfNotExist=function(e){return void 0===e&&(e={}),(0,s.b)(this,void 0,void 0,function(){var t;return(0,s.c)(this,function(n){return t=(0,s.g)((0,s.g)({},k),e),(0,s.q)(x(t)).throw(s.S.invalidParameters),t&&(t.isDistinct=!0),[2,this.createChannel(t)]})})},t.prototype.createChannelWithUserIds=function(e,t,n,r,a,i){return void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=""),void 0===i&&(i=""),(0,s.b)(this,void 0,void 0,function(){var o;return(0,s.c)(this,function(u){return o=(0,s.g)((0,s.g)({},k),{invitedUserIds:e,isDistinct:t,name:n,data:a,customType:i}),"string"==typeof r?o.coverUrl=r:o.coverImage=r,[2,this.createChannel(o)]})})},t.prototype.markAsReadAll=function(){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(e){return this._manager.markAsReadAll(),[2]})})},t.prototype.markAsReadWithChannelUrls=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){return(0,s.q)((0,s.l)("string",e)).throw(s.S.invalidParameters),this._manager.markAsReadWithChannelUrls(e),[2]})})},t.prototype.markAsDelivered=function(e){return(0,s.b)(this,void 0,void 0,function(){return(0,s.c)(this,function(t){switch(t.label){case 0:return(0,s.q)((0,s.a)("string",e)).throw(s.S.invalidParameters),[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}})})},t}(s.ai)}}]);